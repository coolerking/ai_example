 正規 化 、 非 正規 形 、 第 1 正規 形 。 ここ で は 、 第 1 ～ 3 正規 化 および 高次 の 正規 形 について 学習 し ます 。 正規 化 。 無秩序 に 表 （ 関係 ） を 作成 する と 、 データ の 重複 や 整合 性 が 正しく 保つ こと の でき ない 構造 に なる 可能 性 が あり ます 。 この ため 一般 的 に は 、 正規 化 （ normalization ） という 定め られ た ルール に従って 表 を 設計 する こと で 、 データ の 一貫 性 と 整合 性 を 維持 可能 な 構造 に 変換 し ます 。 正規 化 に は 、 段階 的 な 状態 と 、 変換 作業 が あり ます 。 一般 的 な データベース 設計 で は 第 3 正規 形 まで 行え ば 十分 で ある と いわ れ て い ます 。 一 事実 一 箇所 。 一つ の データ は 一 箇所 のみ に 存在 する こと を 一 事実 一 箇所 と いい ます 。 正規 化 は 、 一 事実 一 箇所 を 実現 する ため に 実施 し ます 。 更新 時 異状 。 新規 の 行 を 挿入 し たり 、 既存 行 の 一部 の 値 を 変更 し たり 、 行 を 削除 し たり する 際 に 、 データ の 整合 性 を 損なう こと を 総称 し て 更新 時 異状 と よび ます 。 正規 化 を 進める こと で 、 更新 時 異状 が 発生 する 可能 性 を 下げる こと が でき ます 。 正規 化 し ない ケース 。 設計 対象 と なる 表 の 用途 によって 、 あえて 正規 化 を 行わ ない 場合 も あり ます 。 データ の 追加 のみ で 更新 を 行わ ない 。 参照 が 中心 の 表 を 正規 化 する こと で 表 分解 を 進め て しまう と 、 参照 の たび に 表 データ を 連結 する 処理 が 必要 と なり 、 処理 速度 が 遅く なる こと が あり ます 。 古い 商品 の 単価 表 など 過去 の 履歴 を 参照 する 業務 が ある 場合 は 、 業務 上 データ は 追加 さ れ ます が 、 更新 や 削除 を 実施 し ませ ん 。 この よう な 場合 は 、 正規 化 を あえて 実施 せ ず に 、 検索 結果 データ に 近い 構造 で 設計 する こと が あり ます 。 処理 速度 を 向上 さ せる 必要 が ある 。 更新 時 異状 の 可能 性 を 上げ て も 、 業務 上 など の 理由 により アプリケーション の 処理 速度 を 向上 さ せる 必要 が ある 場合 、 正規 化 を 実施 し ない こと が あり ます 。 一般 的 な システム 開発 で は 、 データベース の 分析 ・ 設計 の 上流 で 正規 化 作業 を 実施 し 、 中流 以降 の 作業 で 実装 環境 を 考慮 し て 非 正規 化 を 検討 ・ 実施 し ます 。 非 正規 形 。 非 正規 形 の 定義 。 「 繰り返し 属性 など の ある 正規 化 さ れ て い ない 表 （ 関係 ） を 非 正規 形 という 」 。 「 注文 」 表 は いずれ も 非 正規 形 です 。 ある 注文 番号 に対して 、 「 商品 番号 」 、 「 商品 名 」 、 「 数量 」 の 三つ の 属性 に 複数 の 値 が 入っ て い ます 。 これら を 繰り返し グループ と よび ます 。 表 を 式 型式 の 関係 スキーマ で 表現 する 際 に 、 以下 の 様 に 記述 する こと が あり ます 。 注文 （ 注文 番号 , 注文 日 , 顧客 番号 , 顧客 名 , { 商品 番号 , 商品 名 , 数量 }）。 繰り返し グループ について は 中 括弧 「 {}」（ べき 集合 ） の 中 に 列挙 し ます 。 非 正規 化 は 、 特に 帳票 や 画面 イメージ を もと に 表 を 設計 する 際 （ ボトムアップ アプローチ ） の 初期 に 現れ ます 。 非 正規 形 における 問題 。 正規 化 を 実施 し て い ない 非 正規 形 の 表 に は 、 以下 の 様 な 問題 が あり ます 。 データ の 重複 。 「 注文 」 表 の 場合 、 繰り返し グループ と それ 以外 の 固定 部分 両方 に 重複 し た データ が 存在 し て い ます 。 この よう に 非 正規 形 の 表 に は 、 同じ データ が 重複 し て 存在 する 可能 性 が 高く なり ます 。 アプリケーション が 複雑 。 「 注文 」 表 の 場合 、 顧客 「 田中 一郎 」 の 名称 変更 に は 6 箇所 、 商品 「 国語 辞典 」 の 名称 を 変更 する に は 3 箇所 の 値 を 変更 する 必要 が あり ます 。 非 正規 形 の 表 で は データ が 重複 する ため 、 挿入 、 削除 、 更新 など の データ 操作 する 場合 、 手順 が 複雑 に なり ます 。 更新 時 異状 の 可能 性 が 高い 。 非 正規 形 の 表 に対する データ 操作 は 、 アプリケーション 側 で 複数 の 手順 で 実装 さ れる 場合 が 多く なり ます 。 この ため 複数 の アプリケーション が 並行 し て 動作 する 場合 、 更新 時 異状 を 発生 さ せる 可能 性 が あり ます 。 「 注文 」 表 は 、 繰り返し グループ と それ 以外 の 固定 部分 両方 とも 更新 時 異状 を 発生 さ せる 可能 性 が あり ます 。 正規 化 を 実施 する こと で 、 これら の 問題 が 発生 する 可能 性 を 下げる こと が でき ます 。 第 1 正規 形 。 第 1 正規 形 の 定義 。 「 繰り返し 属性 の ない 表 を 第 1 正規 形 という 」 。 「 注文 」 表 、 「 注文 商品 」 表 は 、 「 注文 」 表 を 正規 化 し て 第 1 正規 形 に 変換 し た もの です 。 「 注文 」 表 、 「 注文 商品 」 表 とも に 繰り返し 属性 が ない こと を 確認 し て 下さい 。 第 1 正規 化 。 非 正規 形 の 表 に対して 第 1 正規 形 へ 変換 する こと を 第 1 正規 化 と いい ます 。 第 1 正規 化 の 一般 的 な 手順 は 、 以下 の とおり です 。 繰り返し グループ を 抽出 し 、 属性 を 固定 部分 と 繰り返し 部分 に 分ける 。 繰り返し 属性 で ある か どう か 表 の すべて の 属性 を 調べ ます 。 「 注文 」 表 の 場合 、 繰り返し 属性 は 「 商品 番号 」 、 「 商品 名 」 、 「 数量 」 の 三つ 、 残り の 属性 が 固定 部分 と なり ます 。 固定 部分 のみ の 表 と 繰り返し 部分 のみ の 表 に 分割 する 。 「 注文 」 表 の 場合 、 「 注文 番号 」 から 「 顧客 名 」 まで （ 固定 部分 のみ の 表 ） と 、 「 商品 番号 」 から 「 数量 」 まで （ 繰り返し 属性 のみ の 表 ） の 二つ に 表 分割 し ます 。 キー を 付加 する 。 固定 部分 のみ の 表 は 「 注文 番号 」 が 決定 すれ ば 残り の 属性 の 値 が すべて 決まる ので 、 「 注文 番号 」 を 主 キー に 指定 し ます 。 繰り返し 属性 のみ の 表 の うち 「 数量 」 は 、 ほか の 属性 により 値 を 一つ に 決める こと が でき ず 、 単独 で 主 キー を 設定 でき ませ ん 。 そこで 新た に 属性 を 付加 し て 主 キー を 設定 し ます 。 「 例 で は 、 「 注文 番号 」 を 付加 し て 「 注文 番号 」 と 「 商品 番号 」 の 複合 キー を 主 キー として 指定 し ます 。 この 例 で は 設定 し て い ませ ん が 、 表 を 構成 する 属性 によって は 外部 キー を 指定 する 場合 も あり ます （ この 場合 は 「 注文 番号 」 が 外部 キー に も なり ます ） 。 表 の 名称 を つける 表 の 内容 を 総称 する 名称 を つけ ます 。 「 注文 」 表 の 場合 、 固定 部分 は そのまま 「 注文 」 表 の 名前 を つけ まし た 。 繰り返し 部分 は 注文 し た 商品 と 数量 が 入っ て いる ので 「 注文 商品 」 という 名前 に し まし た 。 正規 化 を 実施 し た 際 に は 、 分解 後 の 表 を 結合 し て もと の 表 に もどる こと を 確認 し て 下さい 。 正規 化 と は 、 定め られ た ルール に従って 表 を 設計 する こと で 、 データ の 一貫 性 と 整合 性 を 維持 可能 な 構造 に 変換 する こと で ある 。 データ の 追加 のみ で 更新 を 行わ ない 場合 、 処理 速度 を 向上 さ せる 必要 が ある 場合 など で は 正規 化 を 実施 し ない こと が ある 。 繰り返し 属性 の ある 表 は 非 正規 形 で あり 、 繰り返し 属性 の ない 表 を 第 1 正規 形 と いう 。 第 2 正規 形 。 第 2 正規 形 の 定義 。 「 部分 関数 従属 性 が 存在 し ない 第 1 正規 形 で ある 表 を 、 第 2 正規 形 という 」 部分 関数 従属 性 。 候補 キー の 一部 に 関数 従属 する 非 キー 属性 が 存在 する 場合 、 その 表 は 部分 関数 従属 し て いる と いい ます 。 「 候補 キー の 一部 」 と は 、 候補 キー から 一つ 以上 の 属性 を とりのぞい た もの を さし ます 。 「 注文 商品 」 表 の 場合 、 候補 キー は { 注文 番号 , 商品 番号 } のみ です 。 { 注文 番号 , 商品 名 } は 、 一番 下 に 「 異なる 商品 で 同じ 商品 名 で ある 可能 性 あり 」 と ある ため 、 候補 キー で は あり ませ ん 。 この ため 、 「 候補 キー の 一部 」 と は 、 { 注文 番号 }、{ 商品 番号 } の 二つ に なり ます 。 非 キー 属性 と は 、 候補 キー の 要素 と なっ て い ない 残り の 属性 の こと を さし ます 。 「 注文 商品 」 表 の 場合 、 「 商品 名 」 と 「 数量 」 が 非 キー 属性 と なり ます 。 ここ で 、 候補 キー の 一部 で ある 「 商品 番号 」 に 、 非 キー 属性 「 商品 名 」 が 関数 従属 し て いる こと は 明らか です 。 この ため 、 「 注文 商品 」 表 は 部分 関数 従属 し て いる こと が わかり ます 。 完全 関数 従属 性 。 候補 キー の 一部 に 関数 従属 する 非 キー 属性 が 存在 し ない 場合 、 その 表 は 完全 関数 従属 し て いる と いい ます 。 「 注文 商品 」 表 の 「 候補 キー 」 は { 注文 番号 , 商品 番号 } 以外 存在 し ませ ん 。 この ため 「 候補 キー の 一部 」 は { 注文 番号 }、{ 商品 番号 } の 二つ に なり ます 。 また 非 キー 属性 は 、 候補 キー の 要素 以外 で ある 「 数量 」 のみ と なり ます 。 「 数量 」 は 「 注文 番号 」 に 関数 従属 し て い ませ ん 。 「 数量 」 は 「 商品 番号 」 に も 関数 従属 し て い ませ ん 。 この ため 、 「 注文 商品 」 表 は 完全 関数 従属 し て い ます 。 第 2 正規 形 の 判別 。 第 1 正規 形 で ある 表 に対して 、 第 2 正規 形 で ある か どう か を 判別 する に は 、 部分 関数 従属 性 の 有無 を 調べ ます 。 一般 的 に 第 2 正規 形 で ある か どう か を 判別 する 際 に 、 テーマ 008 で 学習 し た 関数 従属 性 の 表記 法 を 使用 し て 部分 関数 従属 性 の 有無 を 調べ ます 。 「 注文 商品 」 表 の 関数 従属 性 は 、 以下 の とおり です 。 { 注文 番号 , 商品 番号 } → { 数量 }、{ 商品 番号 } → { 商品 名 }。「 注文 商品 」 表 は { 注文 番号 , 商品 番号 } という 候補 キー が 存在 する こと 、 そして 候補 キー の 一部 で ある 「 商品 番号 」 に 非 キー 属性 で ある 「 商品 名 」 が 関数 従属 し て いる こと が よく わかり ます 。 DB 試験 で は 、 まず 関数 従属 性 の 図示 を 完成 さ せ 、 その後 第 2 正規 形 か どう か を 問う 問題 が よく 出題 さ れ ます 。 第 2 正規 化 の 手順 。 第 1 正規 形 を 第 2 正規 形 へ 変換 する 作業 を 第 2 正規 化 と いい ます 。 第 2 正規 化 を おこなう に は 、 表 から 部分 関数 従属 性 を 排除 し ます 。 一般 的 な 第 2 正規 化 の 手順 は 、 以下 の とおり です 。 「 販売 実績 」 表 の 関数 従属 性 の 図示 を 例 に 、 第 2 正規 化 を 学習 し ましょ う 。 関数 従属 性 を 図示 する 。 すべて の 関数 従属 性 を 洗い出す こと が 目的 な ので 、 必ずしも 図示 し なく て も 良い の です が 、 複雑 な 表 の 場合 は 図示 する こと で 構造 が 明確 に なり ます 。 これから 第 2 正規 化 を おこなう 「 販売 実績 」 表 の 関数 従属 性 を すべて 表記 し て いる こと と し ます 。 候補 キー を すべて 洗い出す 図 から 候補 キー を 洗い出し ます 。 基本 的 に 図 の 矢印 の 根元 を 追う こと で 候補 キー を 見つける こと が でき ます 。 矢印 の 根元 は 以下 の 三つ です 。 { 伝票 番号 , 明細 番号 }、{ 販売 店 コード , レジ 番号 , レシート 番号 , 販売 年月日 }、{ 伝票 番号 }。 ここ で 、 { 販売 店 コード , レジ 番号 , レシート 番号 , 販売 年月日 } と { 伝票 番号 } が 相互 に 関数 従属 し て いる ので 、 どちら を 用い て も { 売上 金額 , 従業 員 番号 } を 特定 する こと が でき ます 。 この ため 、 { 伝票 番号 , 明細 番号 } と { 販売 店 コード , レジ 番号 , レシート 番号 , 販売 年月日 , 明細 番号 } の 二つ が 候補 キー で ある こと が わかり ます 。 非 キー 属性 を すべて 洗い出す 。 ② を 実施 する こと で 、 自動的 に 非 キー 属性 の 洗い出し も 完了 し て い ます 。 この 場合 は すでに 、 「 伝票 番号 」 、 「 販売 店 コード 」 、 「 レジ 番号 」 、 「 レシート 番号 」 、 「 販売 年月日 」 、 「 明細 番号 」 が 候補 キー の 要素 で ある こと が わかっ て い ます 。 この ため 残り の 「 SKU コード 」 、 「 販売 価格 」 、 「 数量 」 、 「 売上 金額 」 、 「 従業 員 番号 」 が 非 キー 属性 と なり ます 。 候補 キー の 一部 に 関数 従属 する 非 キー 属性 を すべて 特定 する 。 洗い出さ れ た 属性 の 組み合わせ を 総 当たり で 調べる こと と なり ます 。 もちろん 、 ここ で 総 当たり の 関数 従属 性 を 個々 に 調べ て も 構い ませ ん が 、 関数 従属 性 の 図示 を 用い て 、 特定 する こと の ほう が 比較的 簡単 に 発見 でき ます 。 まず 候補 キー の 一部 が 矢印 の 根元 に なる 関数 従属 性 を 調べる ため 、 候補 キー 要素 すべて に 網 掛け し ます 。 次に 、 網 掛け し た 属性 から 、 網 掛け し て い ない 非 キー 属性 へ 向かう 矢印 を 調べ ます 。 5 本 の 矢印 で 該当 する もの は 、 A 、 B 、 C の 3 本 と なり ます 。 この うち 、 A の 根元 は { 伝票 番号 , 明細 番号 } という 候補 キー そのもの です ので 除外 し ます 。 B 、 C の 根元 は { 伝票 番号 }、{ 販売 店 コード , レジ 番号 , レシート 番号 , 販売 年月日 } という 候補 キー 要素 の 一部 です 。 この ため 、 この 2 本 の 矢印 が 、 候補 キー の 一部 に 関数 従属 する 非 キー 属性 の すべて と なり ます 。 表 を 分解 し て 、 部分 関数 従属 性 を 満たす 関数 従属 を 排除 する 。 洗い出し た 関数 従属 性 を 別 の 表 に 分解 し ます 。 B と C を 別 の 表 に 分解 し ます 。 その 際 、 分解 先 の 表 に 部分 関数 従属 性 が 残ら ない よう に し なけれ ば なり ませ ん 。 たとえば { 伝票 番号 } と { 販売 店 コード , レジ 番号 , レシート 番号 , 販売 年月日 } を 別 の 表 に 切り出し た 場合 、 非 キー 属性 も 一緒 に し て しまう と 部分 関数 従属 性 が 残っ て しまい ます 。 この ため 非 キー 属性 の ない 表 として 切り出し 、 部分 関数 従属 性 を 避ける など で 回避 し ます 。 分割 例 の 一つ です 。 キー を 付加 する 。 分解 後 の 各 表 の 関数 従属 性 を もと に キー を 配置 し ます 。 関数 従属 性 を 考慮 し て 、 左側 は { 伝票 番号 }、 右 上側 は { 伝票 番号 , 明細 番号 }、 右 下 側 は { 伝票 番号 } を 主 キー に し ます 。 表 の 名称 を つける 。 次に 内容 に あっ た 名称 を つけ ます 。 名称 について は 、 業務 内容 や 各 属性 の 詳しい 内容 に より ます が 、 ここ で は 名称 を つけ まし た 。 第 1 正規 化 で も 説明 し まし た が 、 第 2 正規 化 の ため に 表 分解 を 実施 し た 際 に も 、 表 を 連結 し て 情報 の 損失 の 有無 を 必ず 確認 し て 下さい 。 部分 関数 従属 性 が 存在 し ない 第 1 正規 形 で ある 表 を 、 第 2 正規 形 と いう 。 候補 キー の 一部 に 関数 従属 する 非 キー 属性 が 存在 する 場合 、 その 表 は 部分 関数 従属 し て いる と いう 。 第 1 正規 形 を 第 2 正規 形 へ 変換 する 作業 を 第 2 正規 化 と いい 、 表 を 分解 する こと で 部分 関数 従属 性 を 排除 する 。 第 3 正規 形 。 第 3 正規 形 の 定義 。 「 第 2 正規 形 で あり 、 すべて の 非 キー 属性 が いかなる 候補 キー に も 推移 的 に 関数 従属 し ない 表 を 、 第 3 正規 形 という 」 。 推移 的 関数 従属 性 。 以下 の 三つ の 条件 を 満たす 属性 X , Y , Z が 存在 する 時 、 「 Z は X に 推移 的 に 関数 従属 し て いる 」 と いい ます 。 X → Y 。 Y → Z 、 ただし Z は Y の 一部 で は ない 。 Y → X を 満たさ ない 。 「 注文 顧客 」 表 は 、 繰り返し 属性 が なく 、 候補 キー が { 注文 番号 } のみ で あり 部分 関数 従属 性 が 存在 し ませ ん 。 この ため 、 「 注文 顧客 」 表 は 第 2 正規 形 です 。 また 、 「 注文 顧客 」 表 は 、 以下 の 三つ の 条件 を 満たし ます 。 { 注文 番号 } → { 顧客 番号 }。{ 顧客 番号 } → { 顧客 名 }。{ 顧客 番号 } → { 注文 番号 } を 満たさ ない 。 この ため 「 注文 顧客 」 表 の 非 キー 属性 「 顧客 名 」 は 候補 キー { 注文 番号 } に 推移 的 に 関数 従属 し て い ます 。 第 3 正規 形 の 判別 。 「 注文 顧客 」 表 は 、 推移 的 関数 従属 性 が 存在 し て い た ため 、 第 2 正規 形 です が 第 3 正規 形 で は あり ませ ん でし た 。 この よう に 第 2 正規 形 で ある 表 に対して 、 第 3 正規 形 で ある か どう か を 判別 する に は 、 推移 的 関数 従属 性 の 有無 を 調べる こと で 判別 可能 です 。 推移 的 関数 従属 性 の 有無 を 調べる 際 に も 、 関数 従属 性 の 図示 は 有効 です 。 「 注文 顧客 」 表 の 関数 従属 性 を 図示 し た もの です 。 学習 し た 関数 従属 性 の 表記 法 で 表現 し た 図 に 、 候補 キー 要素 に対して 網 掛け を 施し て い ます 。 単純 で ある ため 効果 は ほとんど あり ませ ん が 、 こう する こと で 第 3 正規 形 の 条件 で ある 「 すべて の 非 キー 属性 が いかなる 候補 キー に も 推移 的 に 関数 従属 し ない 」 か を 、 視覚 的 に 調べる こと が でき ます 。 次に 「 顧客 」 表 について 判別 し て み ましょ う 。 「 顧客 」 表 に は 、 繰り返し 属性 が あり ませ ん 。 図 は 「 顧客 」 表 の 関数 従属 性 を 図示 し 、 候補 キー 要素 を 網 掛け し た もの です 。 この 図 より 、 候補 キー が { 顧客 番号 } 以外 に 存在 し ない こと が わかり ます 。 この ため 、 「 顧客 」 表 は 第 2 正規 形 で ある こと が わかり ます 。 さらに 矢印 が 一 本 だけ しか あり ませ ん 。 この ため 「 すべて の 非 キー 属性 が いかなる 候補 キー に も 推移 的 に 関数 従属 し ない 」 ため 、 「 顧客 」 表 は 第 3 正規 形 で ある こと が わかり ます 。 「 非 キー 属性 間 の 関数 従属 性 の ない 第 2 正規 形 の 表 は 、 第 3 正規 形 で ある 」 関数 従属 性 の 図示 を 比較 する と 、 第 2 正規 形 側 に は 非 キー 属性 間 の 関数 従属 が 存在 し ます が 、 第 3 正規 形 の 表 に は 存在 し ない こと が わかり ます 。 これ は 、 非 キー 属性 間 の 関数 従属 性 が 一つ で も 発見 できれ ば 、 ＜ 候補 キー ＞ → ＜ 非 キー 属性 ＞ → ＜ 非 キー 属性 ＞ という 関係 が 自動的 に 存在 する こと と なる ため です 。 ただし 、 午後 問題 で 理由 を 記述 する 際 に は 、 必ず 推移 的 関数 従属 性 の 有無 を 説明 し て ください 。 第 3 正規 化 の 手順 。 第 2 正規 形 を 第 3 正規 形 へ 変換 する 作業 を 第 3 正規 化 と いい ます 。 第 3 正規 化 を おこなう に は 、 表 から 推移 的 関数 従属 性 を 排除 し ます 。 以下 の 「 顧客 」 表 を もと に 、 第 3 正規 化 の 手順 を 学習 し ましょ う 。 顧客 （ 顧客 番号 , 顧客 名 , 企業 コード , 企業 名 , 顧客 取引 開始 日 , 顧客 取引 終了 日 ） 。 「 顧客 」 表 に は 顧客 番号 に 対応 する 顧客 の 情報 が 格納 さ れる 。 「 企業 コード 」 、 「 企業 名 」 は 顧客 が 所属 する 組織 を さす 。 「 企業 コード 」 は 企業 ごと に 一意 に 割り当て られ て いる コード で ある 。 同姓 同名 、 同 一 名称 企業 とも に 可能 性 が ある 前提 と する 。 関数 従属 性 を 図示 する 。 第 2 正規 化 同様 、 すべて の 推移 的 関数 従属 性 を 洗い出す 目的 で ある ため 、 必ずしも 図示 し なく て も 構い ませ ん が 、 図示 により 構造 が 明確 と なり 、 作業 ミス を 低減 する こと が でき ます 。 「 顧客 」 表 の 関数 従属 性 を 図示 し た もの です 。 候補 キー を すべて 洗い出す 。 図 から 候補 キー を 洗い出し ます 。 関数 従属 性 の 図示 から 矢印 の 根元 側 へ と たどる こと で 候補 キー を 比較的 容易 に 発見 する こと が でき ます 。 この 場合 、 関数 従属 性 の 矢印 が 2 本 のみ で 、 「{ 企業 番号 } → { 企業 名 }」 という 関数 従属 性 そのもの が 「 顧客 番号 」 に 関数 従属 し て いる ため 、 候補 キー は { 顧客 番号 } のみ で ある こと が わかり ます 。 非 キー 属性 を すべて 洗い出す 。 まえ の 手順 で 発見 し た すべて の 候補 キー の 要素 以外 が 非 キー 属性 です 。 第 2 正規 化 の 場合 同様 、 関数 従属 性 の 図示 の 候補 キー 要素 のみ 網 掛け など の マーク を つけ て おく と 、 この 後 の 作業 が 容易 です 。 なお 、 ここ まで の 手順 まで は 、 第 2 正規 化 と 同じ です 。 候補 キー に 推移 的 に 関数 従属 する 非 キー 属性 を 洗い出す 。 推移 的 関数 従属 性 を 発見 する に は 、 まず 非 キー 属性 間 の 関数 従属 性 を 洗い出し ます 。 この 場合 、 「{ 企業 番号 } → { 企業 名 }」 という 関数 従属 性 のみ が 該当 し ます 。 表 を 分解 し て 、 推移 的 関数 従属 性 を 満たす 関数 従属 を 排除 する 。 第 2 正規 化 同様 、 第 3 正規 化 も 表 分解 により 、 推移 的 関数 従属 する 要因 と なる 関数 従属 を 切り出し ます 。 キー を 付加 する 。 分解 後 の 各 表 に対して キー を 指定 し ます 。 「{ 企業 番号 } → { 企業 名 }」 を 単純 に 切り出す と 、 元 の 表 と の 間 に 「 顧客 の 所属 する 企業 」 という 情報 が 失わ れ て しまい ます 。 この ため 切り出し 元 に 「 企業 番号 」 を 残し 、 外部 キー として 指定 し ます 。 この よう に 、 第 3 正規 化 で は 、 非 キー 属性 間 の 関数 従属 性 を 切り出す ため 、 外部 キー を 指定 する 場合 が 多く 見受け られ ます 。 表 の 名称 を つける 。 各 表 に対して 名称 を つけ ます 。 「 顧客 」 表 の 分解 で は 、 「 顧客 」 表 、 「 企業 」 表 という 名称 を つけ まし た 。 非 正規 形 から 第 3 正規 形 まで の 正規 化 を まとめ た もの です 。 情報 無 損失 分解 。 分解 し た 後 の 関係 を 結合 し て 元 の 関係 に 復元 できる こと を 情報 無 損失 分解 と いい ます 。 非 正規 形 から 第 1 正規 形 へ の 分解 、 第 1 正規 形 から 第 2 正規 形 へ の 分解 や 、 第 2 正規 形 から 第 3 正規 形 へ の 分解 は 、 常に 情報 無 損失 分解 する こと が でき ます 。 第 2 正規 形 で あり 、 すべて の 非 キー 属性 が いかなる 候補 キー に も 推移 的 に 関数 従属 し ない 表 を 、 第 3 正規 形 と いう 。 X → Y 、 Y → Z で ある が Y → X を 満たさ ない 属性 X , Y , （ Y の 一部 で は ない ） Z が 存在 する 時 、 Z は X に 推移 的 関数 従属 する と いう 。 第 2 正規 形 を 第 3 正規 形 へ 変換 する 作業 を 第 3 正規 化 と いい 、 表 を 分解 する こと で 推移 的 関数 従属 性 を 排除 する 。 高次 の 正規 形 ボイス・コッド 正規 形 。 ボイス・コッド 正規 形 の 定義 。 「 関数 従属 性 が 以下 の 2 つ の 条件 の うち どちら か のみ の 表 は 、 ボイス・コッド 正規 形 で ある 」 。 自明 な 関数 従属 性 で ある 。 決定 項 が スーパー キー で ある 。 自明 な 関数 従属 性 。 Y が X の 部分 集合 で ある 関数 従属 X → Y を 、 自明 な 関数 従属 性 と いい ます 。 テーマ 008 の 反射 律 により 、 自ずと 明らか に なる 関数 従属 性 の こと です 。 例えば 、 「{ 注文 番号 , 商品 番号 } → { 注文 番号 }」 の よう に 、 従属 項 が 、 決定 項 の 部分 集合 に なっ て いる もの を さし ます 。 ボイス・コッド 正規 形 の 適用 例 。 担当 講師 （ 学籍 番号 , 科目 , 講師 番号 ） 。 主 キー は { 学籍 番号 , 科目 }。 学籍 番号 は 、 学生 ごと に 一意 に 割り当て られ て いる 。 講師 番号 は 、 講師 ごと に 一意 に 割り当て られ て いる 。 同じ 名前 の 別 科目 は 存在 し ない 。 1 科目 複数 の 講師 が 担当 する が 、 1 講師 1 科目 を 担当 する 。 「 担当 講師 」 表 に は 、 繰り返し 属性 が あり ませ ん 。 そして 「 担当 講師 」 表 の 候補 キー は { 学籍 番号 , 科目 } と { 学籍 番号 , 講師 番号 } の 二つ 存在 する ため 、 非 キー 属性 が 存在 し ませ ん 。 この ため 「 担当 講師 」 表 は 第 3 正規 形 で ある こと が わかり ます 。 また 「 担当 講師 」 表 は 、 以下 の 理由 により ボイス・コッド 正規 形 で は あり ませ ん 。 { 学籍 番号 , 科目 } → { 講師 番号 }。{ 学籍 番号 , 科目 } は 、 主 キー で ある ため 、 ボイス・コッド 正規 形 の 定義 ② を 満たし ます 。 { 講師 番号 } → { 科目 }。 この 関係 は 、 自明 な 関数 従属 性 で も 、 「 講師 番号 」 が スーパー キー で も ない ため 、 ボイス・コッド 正規 形 の 定義 を 満たし ませ ん 。 正規 化 によって 表 の 中 の 関数 従属 性 を 表 分解 により 分離 し て 、 より データ 重複 の 少ない 構造 へ 変換 し て き まし た が 、 「 担当 講師 」 表 の よう な 候補 キー 間 の 関数 従属 性 を 含む 表 について は 、 第 3 正規 化 まで で は 整理 する こと は でき ませ ん 。 この よう な 場合 、 第 3 正規 形 を ボイス・コッド 正規 形 へ 変換 する ボイス・コッド 正規 化 を 実施 し て 、 自明 で は ない 関数 従属 性 を 排除 し ます 。 「 担当 講師 」 表 を ボイス・コッド 正規 化 により 表 分解 し た 結果 です 。 ボイス・コッド 正規 化 は 、 情報 損失 を 発生 さ せる こと が あり ます 。 学籍 番号 「 4 」 の 「 数学 」 を 担当 する 講師 が 講師 番号 「 102 」 で ある 情報 が 存在 し ます が 、 二つ の 表 を 結合 し て も 情報 を 復元 する こと が でき ませ ん 。 第 4 正規 形 。 第 4 正規 形 の 定義 。 「 多値 従属 性 が 以下 の ２つ の 条件 の うち どちら か のみ の 表 は 、 第 4 正規 形 で ある 」 。 自明 な 多値 従属 性 で ある 。 決定 項 が スーパー キー で ある 。 多値 従属 性 。 X の 値 が 一つ 決まる と 、 Y の 値 が 一つ 以上 決定 する とき 、 「 Y は X に 多値 従属 する 」 と いい ます 。 なお 、 関数 従属 性 は Y の 値 が 一つ 決まる 場合 の こと です 。 「 Y は X に 多値 従属 する 」 こと を 「 X → → Y 」 と 式 で 表記 し ます 。 自明 で は ない 多値 従属 性 。 互いに 独立 な 意味 を もつ 二つ の 多値 従属 性 X → → Y と X → → Z が 表 の 中 に 存在 する こと を 自明 で は ない 多値 従属 性 と いい 、 「 X → → Y | Z 」 と 式 で 表記 し ます 。 第 4 正規 形 の 適用 例 。 講義 （ 科目 , 書籍 番号 , 講師 番号 ） 。 主 キー は { 科目 , 書籍 番号 , 講師 番号 }。 同じ 名前 の 別 科目 は 存在 し ない 。 書籍 番号 は 、 書籍 ごと に 一意 に 割り当て られ て いる 。 講師 番号 は 、 講師 ごと に 一意 に 割り当て られ て いる 。 1 科目 1 種類 以上 の 書籍 を 使用 する 。 1 科目 1 名 以上 の 講師 が 担当 する 。 講師 は 、 授業 で 使用 する 書籍 を 選定 でき ない 。 「 講義 」 表 に は 繰り返し 属性 が なく 、 そもそも 表 の 中 に 関数 従属 性 が 存在 し ませ ん 。 この ため 「 講義 」 表 は 、 第 1 正規 形 から ボイス・コッド 正規 形 まで の 定義 を すべて 満たす こと に なり ます 。 しかし 「 講義 」 表 は 、 第 4 正規 形 で は あり ませ ん 。 「 講義 」 表 に は 以下 の 二つ の 多値 従属 性 のみ 存在 する ため です 。 { 科目 } → → { 書籍 番号 }「 講義 」 表 の 候補 キー は { 科目 , 書籍 番号 , 講師 番号 } で ある ため 、 「 科目 」 は スーパー キー で は あり ませ ん 。 よって この 多値 従属 性 は 第 4 正規 形 の 定義 ② を 満たし ませ ん 。 { 科目 } → → { 講師 番号 }。 この 多値 従属 性 も 決定 項 が 「 科目 」 で ある ため 、 第 4 正規 形 の 定義 ② を 満たし ませ ん 。 また 、 「 科目 」 「 書籍 番号 」 、 「 講師 番号 」 の 値 が 決まる 際 に は 、 「 科目 」 以外 の 属性 の 影響 を うけ て い ませ ん 。 この ため 「 講義 」 表 は 自明 で は ない 多値 従属 性 「 { 科目 }→→{ 書籍 番号 }|{ 講義 番号 }」 が 存在 し ます 。 「 講義 」 表 の よう な 自明 で は ない 多値 従属 性 を もつ 表 に対して は 、 データ 重複 を さらに 削減 する に は ボイス・コッド 正規 化 まで で は 整理 する こと は でき ませ ん 。 この よう な 場合 、 ボイス・コッド 正規 形 を 第 4 正規 形 へ 変換 する 第 4 正規 化 を 実施 し て 、 自明 で は ない 多値 従属 性 を 排除 し ます 。 「 講師 」 表 を 第 4 正規 化 により 表 分解 し た 結果 です 。 各々 自明 な 多値 従属 性 です 。 第 4 正規 化 も 、 情報 損失 を 発生 さ せる こと が あり ます 。 「 関数 従属 性 」 という 科目 の 講義 において 講師 番号 「 102 」 の 講師 は 書籍 番号 「 B 02 」 のみ 使用 し て いる こと が わかり ます が 、 二つ の 表 を 連結 し て も 該当 情報 を 取得 する こと は でき ませ ん 。 高次 の 正規 形 の 出題 例 。 以下 の 「 販売 実績 」 表 は 第 何 正規 形 か 。 販売 実績 （ 期間 , 書籍 番号 , 売上 冊数 ） 。 「 販売 実績 」 表 は 、 期間 ごと の 書籍 の 売上 冊数 を あらわす 。 書籍 番号 と は 、 書籍 を 一意 に 識別 する 番号 の こと で ある 。 期間 と は 、 販売 実績 の 集計 期間 を あらわす 。 売上 冊数 と は 、 期間 中 の 書籍 ごと の 売上 合計 冊数 で ある 。 「 期間 ごと の 書籍 の 売上 冊数 」 を 1 行 で あらわす 表 で ある ため 、 繰り返し 属性 が ない こと が わかり 、 まず 第 1 正規 形 で ある こと が わかり ます 。 次に 、 「 販売 実績 」 表 に ある 関数 従属 性 を 洗い出し ます 。 問題 から 、 以下 の 関数 従属 性 が 一つ のみ 存在 する こと が わかり ます 。 { 期間 , 書籍 番号 } → { 売上 冊数 }。 この ため 部分 関数 従属 性 が 存在 し ない こと が わかり 、 第 2 正規 形 で ある こと が 判明 し ます 。 また 、 非 キー 属性 間 で 関数 従属 性 が ない こと から 推移 的 関数 従属 性 も 存在 し ない こと も わかる ため 、 第 3 正規 形 で ある こと も 判明 し ます 。 さらに 「 販売 実績 」 表 の 多値 従属 性 を 洗い出し ます 。 しかし 上記 の 関数 従属 性 以外 に 多値 従属 性 を 発見 する こと は でき ませ ん 。 「 販売 実績 」 表 の 候補 キー が { 期間 , 書籍 番号 } で ある こと から 、 第 4 正規 形 で ある こと が わかり ます 。 この ため 、 上記 の 解答 は 第 4 正規 形 と なり ます が 、 IPA の 解答 例 で は 第 3 正規 形 で も 正解 に なっ て い ます 。 問題 文 に 「 高次 の 正規 形 まで 検討 せよ 」 など の 条件 が ない 限り 、 午後 試験 で 「 第 何 正規 形 か 」 と 問う 設問 は 、 第 3 正規 形 まで の 解答 で も 正解 が うけ られる こと を 覚え て おい て 下さい 。 なお 、 引用 元 の 設問 の 解答 例 で は 、 第 3 正規 形 、 第 4 正規 形 、 第 5 正規 形 の いずれ か でも 正解 と なっ て い ます 。 関数 従属 性 が 、 自明 な 関数 従属 性 で ある か 、 決定 項 が スーパー キー か の どちら か のみ の 表 は 、 ボイス・コッド 正規 形 で ある 。 多値 従属 性 が 、 自明 な 多値 従属 性 で ある か 、 決定 項 が スーパー キー か の どちら か のみ の 表 は 、 第 4 正規 形 で ある 。 午後 試験 で 「 第 何 正規 形 か 」 と 問う 設問 は 、 第 3 正規 形 まで の 解答 で も 正解 と なる 。 
