 表 と ビュー 。 表 や ビュー 、 索引 など の データベース 内 の オブジェクト について 学習 し ます 。 表 。 DBMS において 、 データ を 格納 する 役割 を 担う の が 表 です 。 表 は 、 表 の 名前 、 列 の データ 型 や 名前 など を 指定 し て 作成 し ます 。 標準 で 定義 さ れ て いる 代表 的 な データ 型 を 示し ます 。 実際 に データ 型 を 決める 際 に は 、 データ 型 が DBMS によって 使用 できる もの が 異なっ たり 、 データ 型 の 名前 が 異なっ たり する ため 、 使用 する DBMS に 合わせ て 選択 し ます 。 表 の 作成 。 表 を 作成 する に は 、 CREATE TABLE 文 を 使用 し ます 。 CREATE TABLE 文 の 書式 を 示し ます 。 CREATE TABLE 文 で は 、 作成 する 表 の 名前 と 表 内 の 列 の 名前 と データ 型 を 指定 し ます 。 また 、 列 の デフォルト 値 を 指定 する こと も でき ます 。 さらに 、 主 キー 制約 や 参照 性 制約 など の 制約 について も CREATE TABLE 時 に 定義 を 行い ます 。 なお 、 制約 および 制約 の 具体 的 な 定義 方法 について は 、 テーマ 031 と 032 で 学習 し ます 。 CREATE TABLE 文 の 実行 例 を 示し ます 。 PRODUCTS 表 を 作成 し て い ます 。 PRODUCTS 表 の 中 の PROD _ CAT 列 に は 、 デフォルト 値 として 「 なし 」 という 文字 列 を 定義 し て い ます 。 この ため 、 INSERT 文 による データ 挿入 時 、 PROD _ CAT 列 の 値 を 指定 し ない 場合 は 文字 列 「 なし 」 が 挿入 さ れ ます 。 表 の 作成 で は 、 あらかじめ ドメイン という データベース オブジェクト を 作成 し て おき 、 ドメイン を 属性 の 代わり に 用いる こと も でき ます 。 ドメイン を 作成 する に は 、 CREATE DOMAIN 文 を 使い ます 。 CREATE DOMAIN 文 の 書式 と 例 を 示し ます 。 表 の 変更 、 削除 。 表 の 変更 に は 、 ALTER TABLE 文 、 表 の 削除 は DROP TABLE 文 を 使用 し ます 。 また 、 以降 説明 する データベース 上 に CREATE から 始まる SQL 文 で 作成 する オブジェクト に関して も 同様 に 、 変更 、 削除 は ALTER < オブジェクト 名 >、 DROP < オブジェクト 名 > 文 を 使用 し ます 。 なお 、 データベース スペシャリスト 試験 で は 、 データベース オブジェクト の 変更 、 削除 について は 出題 さ れ て い ない ため 、 詳細 な 説明 は 割愛 し ます 。 ビュー 。 ビュー は 、 データ の 実体 を 持た ない 仮想 の 表 で 、 一つ ないし 複数 の 表 を 基 に 作成 し ます 。 この とき 、 ビュー の 基 に なっ た 表 の こと を 基底 表 と 呼び ます 。 また 、 ビュー は 、 他 の ビュー を 基 に 作成 する こと も でき ます 。 ビュー を 使用 する こと により 以下 の 2 点 が 実現 でき ます 。 詳細 な アクセス 制御 の 実施 ： 表 の すべて データ を ユーザ に 操作 を 制限 し たい 場合 に 、 ビュー を 定義 する こと によって 、 表 内 の 特定 の データ に 操作 を 制限 できる 。 ユーザ の 操作 の 容易 化 ： 結合 や 副 問い合わせ など の 複雑 な 操作 を ビュー として 定義 し て おく こと により 、 ユーザ が 簡単 な 操作 を 行う だけ で 済む よう に なる 。 ビュー を 作成 する に は 、 CREATE VIEW 文 を 実行 し ます 。 CREATE VIEW 文 の 書式 と 例 を 示し ます 。 ① は 、 PRODUCTS 表 の PROD _ CAT 列 の データ が 書籍 の もの を 抽出 し た ビュー 作成 し て い ます 。 ② の 例 で は 、 PRODUCTS 表 と ORDERS 表 と CUSTOMERS 表 を 内部 結合 し た 結果 を ビュー として 作成 し て い ます 。 この ビュー により ユーザ は 、 結合 を 記述 する こと なく 結合 結果 に対する 操作 を 行う こと が でき ます 。 マテリアライズドビュー （ Materialized View ） 。 マテリアライズドビュー （ 体現 ビュー ） は 、 データ （ 実体 ） を 持っ た ビュー です 。 集計 処理 を 行う SQL を 使用 し て マテリアライズドビュー を 作成 すれ ば 、 集計 結果 を ビュー の 中 に 保持 し 、 使用 でき ます 。 この よう に マテリアライズドビュー は 、 主 に 、 集計 処理 の 効率 化 の ため に 用い ます 。 通常 の ビュー に対して SQL 文 は 、 基底 表 の データ を 用い て 実行 さ れ ます 。 一方 、 マテリアライズドビュー に対する SQL は 、 マテリアライズドビュー が 持つ 集計 済み データ を 使用 し て 実行 する ため 、 集計 処理 の 手間 が 省ける 分 、 高速 に 処理 さ れ ます 。 作成 し た マテリアライズドビュー の データ は 、 基底 表 の データ に対して 、 あらかじめ 指定 し た タイミング で 同期 さ れ ます 。 同期 の タイミング を リアルタイム に 近く する ほど 、 マテリアライズドビュー の データ は 基底 表 に対して 最新 の もの に 近く なり ます 。 一方 、 基底 表 に対する 更新 操作 は 、 マテリアライズドビュー へ の 反映 が 必要 に なる 分 、 遅く なり ます 。 ビュー に対して 更新 が 行える もの を 更新 可能 ビュー と 呼ん で い ます 。 更新 が 行える か どう か は 、 UPDATE 文 や INSERT 文 など の 更新 処理 が 基底 表 に対して 、 整合 性 が とれ た 状態 で 行える か どう か に より ます 。 各 オブジェクト の 役割 と 定義 方法 を 覚える こと が 重要 で ある 。 共通 に 使用 する 属性 を ドメイン として 定義 する と 、 表 作成 時 、 属性 の 代わり に 使用 できる 。 ビュー は 、 仮想 の 表 で あり データ （ 実体 ） を 持た ず 、 セキュリティ の 向上 、 表操作 の 容易 化 の ため に 使う 。 権限 。 権限 と は 。 ユーザ が 、 表 や ビュー など の データベース 内 の オブジェクト に対して 操作 を 行う に は 権限 が 必要 です 。 権限 の イメージ を 示し ます 。 ユーザ X は 、 A 表 に対して SELECT 、 INSERT 、 UPDATE 、 DELETE が 実行 でき ます 。 一方 、 ユーザ Y は A 表 に対して SELECT だけ 実行 でき 、 INSERT や UPDATE は 実行 でき ませ ん 。 また 、 B 表 に対して は 、 ユーザ X 、 Y いずれ も 権限 を 持っ て い ない ため 、 ユーザ X 、 Y は B 表 に対して 操作 を 行う こと は でき ませ ん 。 権限 の 付与 と 剥奪 。 権限 を 付与 する に は GRANT 文 を 、 剥奪 する に は REVOKE 文 を 使用 し ます 。 GRANT 文 と REVOKE 文 の 書式 を 示し ます 。 対象 と する データベース の オブジェクト によって 、 付与 できる 権限 が 異なり ます 。 表 および ビュー の 権限 を 示し ます 。 REFERENCES 権限 について は 外部 キー 制約 で 詳細 を 説明 し ます 。 再び 、 GRANT 文 の 書式 に関する 説明 に 戻り ます 。 GRANT 文 や REVOKE 文 で は 、 対象 と する ユーザ や ロール を 指定 し ます 。 指定 する ユーザ に は すべて の ユーザ を 指す PUBLIC という 、 特別 な もの も 使用 でき ます 。 PUBLIC に 付与 さ れ た 権限 は 、 DBMS 内 の すべて ユーザ の 共通 の 権限 と なり ます 。 また WITH GRANT OPTION を 指定 する と 、 権限 を 付与 さ れ た ユーザ が 、 新た に 別 の ユーザ に対して 権限 を 付与 できる よう に なり ます 。 権限 の 付与 と 剥奪 の 実行 例 を 示し ます 。 DBMS 管理 者 が ユーザ に 権限 を 付与 し 、 さらに 権限 を 付与 さ れ た ユーザ が 他 の ユーザ へ 権限 を 付与 し て いる 例 です 。 ① の GRANT 文 で 、 DBMS 管理 者 は 、 ユーザ sato に A 表 へ の SELECT と INSERT を 実行 する 権限 を WITH GRANT OPTION を 指定 し て 付与 し て い ます 。 ② の GRANT 文 で は 、 ユーザ suzuki に B 表 へ の SELECT 、 INSERT 、 UPDATE 、 DELETE 権限 を ALL PRIVILEGES を 指定 し 、 与え て い ます 。 ③ で は 、 ユーザ sato が DBMS 管理 者 に 付与 さ れ た 権限 の 中 から 、 SELECT 権限 を ユーザ suzuki に 付与 し て い ます 。 これ により 、 ユーザ suzuki も A 表 へ SELECT 文 の 実行 が でき ます 。 ④ で は 、 DBMS 管理 者 が ユーザ suzuki に 付与 し た B 表 に対する DELETE 権限 を 剥奪 し て い ます 。 その ため 、 ユーザ suzuki は 、 B 表 に対する DELETE 文 の 実行 が でき なく なり ます 。 ビュー へ の 権限 。 表 内 の 特定 の データ へ のみ アクセス を 許可 する 方法 として 、 ビュー が 利用 でき ます 。 表 へ の 権限 の 付与 は 、 表 もしくは 列 の 単位 で しか 行え ませ ん が 、 ビュー を 使用 する こと により 行 の 単位 で の 制御 が 実施 でき ます 。 なお 、 DBMS によって は 、 列 単位 で の 権限 の 付与 が でき ない もの も あり ます 。 その よう な DBMS で 、 列 の 単位 で の アクセス を 制御 する とき に も ビュー を 用い ます 。 ビュー を 使い 表 データ へ の アクセス の 範囲 を 限定 し た 例 を 示し ます 。 EMPLOYEES 表 の 特定 の データ に 限定 し て 、 ユーザ が 操作 できる よう に し た 例 です 。 ビュー EMP _ 5 を 作成 し て （①）、 その ビュー に対して のみ ユーザ takahashi へ SELECT 権限 を 付与 （②） し て い ます 。 ロール 。 ロール を 使用 する と 、 権限 を まとめ られ 、 同じ 権限 を 持た せ たい ユーザ の 追加 や 権限 の 剥奪 の 手順 を 簡単 に でき ます 。 ロール の 作成 は CREATE ROLE 文 で 行い 、 GRANT 文 で ロール に 権限 を 付与 し ます 。 さらに 、 ユーザ と ロール を 紐 づける に は GRANT 文 で 行い ます 。 次に 、 ロール の 使用 例 を 示し ます 。 ロール を 使用 し て ユーザ X 、 Y に 権限 を 与え た 例 です 。 ① で ロール ABC を 作成 し て 、 ②、③ で A 表 へ の SELECT 、 INSERT 、 UPDATE 権限 と B 表 、 C 表 へ の SELECT 権限 を ロール ABC に 付与 し て い ます 。 その後 、 ④ で ロール ABC と ユーザ X 、 Y を 紐 づけ て い ます 。 この よう に ロール を 使い 権限 を まとめる こと により 、 ユーザ の 変更 も 簡単 に なり ます 。 例えば 、 人事 異動 など で ユーザ Y の 代わり に ユーザ Z に 同様 の 権限 を 与え たい よう な 場合 を 考え て み ます 。 この 場合 、 ロール が ある こと によって 、 ユーザ Y から ロール ABC を 剥奪 （ REVOKE ABC FROM Y ） し 、 ユーザ Z に ロール ABC を 付与 （ GRANT ABC TO Z ） する だけ で 済ませる こと が でき ます 。 ユーザ が オブジェクト の 操作 を する に は 権限 が 必要 で ある 。 権限 は 、 オブジェクト 毎 に 、 許可 する 操作 と ユーザ を 指定 する 。 表 の データ に対して 詳細 な アクセス 制御 を 行う に は 、 ビュー を 用いる 。 ロール を 使う と 権限 を まとめ られる 。 制約 。 主 キー 制約 。 主 キー 制約 は 、 指定 し た 列 の 値 が 既存 の 値 と 重複 する 、 または NULL で ある データ の 格納 を 禁止 し ます 。 主 キー 制約 は 、 一つ の 表 に対して 一つ だけ 定義 でき ます 。 制約 は 、 表 の データ に対して 規則 を 定義 し ます 。 制約 を 表 に 設定 する こと により 、 格納 する データ が 制約 に 違反 し て い ない か 、 DBMS に 確認 さ せる こと が でき ます 。 主 キー 制約 は 、 CREATE TABLE 文 で 表 作成 時 に 設定 し ます 。 主 キー 制約 の 書式 を 示し ます 。 主 キー 制約 や 形式 制約 など 制約 を 複数 定義 する とき は 、 上段 の 記述 方式 で は 「 ,」 を 使い 、 下段 の 記述 方式 で は 「 （ スペース ） 」 を 使い 複数 の 制約 を 記述 し ます 。 なお 、 制約 は ALTER TABLE 文 によって 表 の 作成 後 に 制約 を 追加 、 削除 する こと も でき ます 。 主 キー 制約 の 例 を 示し ます 。 主 キー 制約 を 設定 し て いる 表 へ の INSERT 文 と UPDATE 文 の 実行 可否 を 示し た もの です 。 対象 は PRODUCTS 表 で 、 PROD _ ID 列 に 主 キー 制約 を 設定 し て い ます 。 PRODUCTS 表 に は データ が 3 件 格納 済み です 。 この とき ①～⑤ まで の SQL 文 について 実行 可能 か どう か を 見 て いき ます 。 ① の INSERT 文 は 、 PROD _ ID が 104 と 既存 の 値 と 重複 し て い ない ため 実行 でき ます 。 同様 に ② の PROD _ ID を 101 から 201 に 変更 する UPDATE 文 も 重複 し た 値 で は ない ので 実行 でき ます 。 一方 、 ③ の INSERT 文 は 、 PROD _ ID が 102 と 既存 の データ と 重複 し て いる ため 実行 は 失敗 し ます 。 また 、 ④ の INSERT 文 も PROD _ ID が NULL の データ を 格納 しよ う と し て いる ので 失敗 し ます 。 ⑤ の UPDATE 文 も PROD _ ID を 102 から 103 へ と 重複 し て いる 値 へ 変更 しよ う と し て いる ので 失敗 し ます 。 一意 性 制約 。 一意 性 （ ユニーク ） 制約 は 、 指定 し た 列 の 値 が 既存 の 値 と 重複 する データ の 格納 を 禁止 し ます 。 主 キー 制約 と は 異なり 、 NULL の 格納 について は 禁止 し ませ ん 。 すでに NULL の データ が 格納 さ れ て おり 、 そこ へ NULL を 持つ データ を 追加 する 場合 も 制約 の 違反 に は なり ませ ん 。 また 、 一意 性 制約 は 一つ の 表 に 複数 定義 する こと も でき ます 。 一意 性 制約 の 書式 を 例 を 示し ます 。 CUST _ ID 列 と PROD _ ID 列 の 組 に対して 一意 性 制約 を 設定 し て いる ORDERS 表 へ の データ 格納 の 可否 を 示し て い ます 。 この 例 で は 、 二つ に 列 に対して 一つ の 制約 を 付与 し て いる ため 、 値 が 重複 し て いる か どう か は 、 列 と 列 の 値 の 組み合わせ に対して 確認 さ れ ます 。 ① の INSERT 文 は 、 CUST _ ID と PROD _ ID 列 の 値 の 組み が （ 13 , 104 ） と すでに 格納 さ れ て いる データ と は 重複 し て い ない ため 実行 可能 です 。 ② の INSERT は 、 NULL が 入っ て いる ため 成功 し ます 。 一意 性 制約 で は 、 NULL の 重複 も 許可 さ れる ため 、 格納 する データ に NULL が 入っ て いる 時点 で 制約 の 違反 で は なくなり ます 。 一方 、 ③ の INSERT 文 の 実行 は 、 値 の 組み合わせ が （ 13 , 102 ） と 表 に すでに 格納 さ れ て いる データ と 重複 する ため 失敗 し ます 。 ④ の UPDATE 文 も 更新 後 の 値 の 組 が （ 11 , 102 ） と なり 重複 する ため 失敗 し ます 。 非 NULL 制約 。 非 NULL 制約 は 、 設定 し た 列 に NULL が 格納 さ れる の を 禁止 し ます 。 非 NULL 制約 の 書式 を 示し ます 。 非 NULL 制約 は 、 単一 の 列 に対して だけ 定義 でき ます 。 その ため 、 上段 の よう な 記述 の 仕方 は でき ませ ん 。 非 NULL 制約 の 例 を 示し ます 。 形式 制約 。 指定 し た 条件 に 合わ ない データ の 格納 を 禁止 する 制約 が 形式 （ チェック ） 制約 です 。 制約 により 、 格納 さ れる データ の 規則 を 定義 し 、 DBMS に 確認 さ せる こと が できる 。 制約 に は 、 主 キー 、 一意 性 、 形式 、 非 NULL 、 参照 制約 と 表明 が ある 。 各 制約 が 禁止 する こと を 明確 に し て おく こと が 重要 で ある 。 制約 。 参照 制約 。 参照 制約 は 、 リレーショナル モデル の 関連 の 実装 で 、 格納 する 値 が 関連 の ある 列 に も 存在 する こと を 保証 し ます 。 参照 制約 の イメージ を 示し ます 。 当 テキスト で は 、 参照 制約 を 設定 する 表 の こと を 子 表 、 参照 先 の 表 を 親 表 と 呼び ます 。 ORDERS 表 （ 子 表 ） の CUST _ ID 列 から CUSTOMERS 表 （ 親 表 ） の CUST _ ID 列 に 参照 制約 を 設定 し た もの です 。 これ により ORDERS 表 （ 子 表 ） の CUST _ ID 列 に 格納 できる 値 を 、 CUSTOMERS 表 （ 親 表 ） の CUST _ ID 列 登録 済み の 11 、 12 、 13 に 限定 する こと が でき ます 。 なお 、 参照 制約 を 設定 し て いる 子 表 の 列 に NULL を 格納 する 場合 、 親 表 の 列 に NULL が なく て も 格納 する こと が でき ます 。 NULL の 格納 を 防ぐ に は 、 NOT NULL 制約 もしくは 主 キー 制約 を 設定 し ます 。 また 、 親 表 と 子 表 に 新規 の データ を 挿入 する 際 は 、 親 表 へ 先 に データ を 格納 し 、 その後 、 子 表 に 関連 する データ を 挿入 する 必要 が あり ます 。 参照 制約 の 設定 は 、 子 表 を 作成 する とき に 行い ます 。 参照 制約 の 書式 を 示し ます 。 参照 制約 は 、 同じ 表 内 の 列 間 で 設定 する こと も でき ます 。 なお 、 親 表 の 対象 列 に は あらかじめ 、 主 キー 制約 か 一意 性 制約 が 設定 さ れ て いる こと が 必要 です 。 また 、 子 表 作成 時 、 親 表 の 対象 列 に対する REFFERENCES 権限 が 必要 に なり ます 。 参照 制約 の 例 を 示し ます 。 CUSTOMERS 表 を 親 表 と する ORDERS 表 （ 子 表 ） へ の データ の 格納 可否 を 示し て い ます 。 親 表 と 子 表 に は 、 データ が 格納 さ れ て い ます 。 この とき の ①～③ の INSERT 文 の 実行 可否 を 見 て いき ます 。 ① は 、 子 表 の CUST _ ID に 11 を 挿入 する INSERT 文 です 。 親 表 で の CUST _ ID に 11 という 値 が ある ため ① の INSERT 文 の 実行 は 成功 し ます 。 ② の INSERT 文 は 、 子 表 の CUST _ ID に NULL を 挿入 しよ う と し て い ます 。 参照 制約 で は 親 表 に NULL が なく て も 子 表 へ の NULL の 格納 は 許可 する ため 、 ② の INSERT 文 の 実行 も 成功 し ます 。 一方 、 ③ の INSERT 文 は 、 CUST _ ID に 14 を 挿入 しよ う と し て い ます 。 親 表 の CUST _ ID 列 に は 14 という 値 は 格納 さ れ て い ない ため 、 ③ の INSERT 文 の 実行 は 失敗 し ます 。 削除 規則 と 更新 規則 。 参照 制約 で は 、 子 表 が 参照 し て いる 親 表 の データ が 削除 または 更新 さ れ た 場合 の 動作 を 選択 でき 、 この 動作 を 削除 規則 、 更新 規則 で 指定 し ます 。 削除 規則 と 更新 規則 の 書式 を 動作 イメージ を 示し ます 。 表明 。 表明 を 使う と 、 SELECT 文 を 使用 し た 複雑 な 制限 を 設定 でき ます 。 表明 は 、 CREATE ASSERTION 文 で 作成 し ます 。 表明 の 書式 と 例 を 示し ます 。 参照 制約 は 、 役割 と共に 構文 も 覚え て おく こと が 重要 で ある 。 参照 制約 に 指定 できる 削除 、 更新 規則 の それぞれ の 動作 を 理解 する 。 表明 は 、 SELECT 文 を 使用 し た 複雑 な 制限 を 設定 できる 。 索引 。 B + TREE 索引 。 B + TREE 索引 は 、 ツリー 状 の 構造 です 。 通常 、 単に 索引 と いう と この B + TREE 索引 を 指し ます 。 索引 （ インデックス ） は 、 検索 性能 を 向上 さ せる ため の もの です 。 DBMS によって は 、 主 キー 制約 や 一意 性 制約 作成 時 に 暗黙 的 に 索引 （ B + TREE 索引 ） を 作成 する もの も あり ます 。 索引 に は 、 B + TREE 索引 や ビット マップ 索引 など が あり ます 。 VEGETABLES 表 の ID 列 に対する B + TREE 索引 の イメージ を 示し ます 。 B + TREE 索引 の 構造 は 、 一つ の ルート ノード から 二つ 以上 の 分岐 を 行い 、 ルート ノード から リーフ ノード まで の 深 さ は すべて 同一 と なり ます 。 また 、 リーフ ノード から 次 の リーフ ノード へ の ポインタ を 持ち ます 。 リーフ ノード に 、 表 の 行 データ へ の ポインタ を 持ち ます 。 B + TREE 索引 を 使用 し た データ の 読み取り 方法 。 次に 、 同じく ID が 160 の データ を 取得 する まで の 表 データ を 直接 読み込ん だ 場合 と B + TREE 索引 を 使用 し た 場合 の 違い を 見 て いき ます 。 ここ で 、 ID 160 は VEGETABLES 表 内 に ひとつ だけ 格納 さ れ て いる と し ます 。 表 の データ を 直接 読み込ん で VEGETABLES 表 の ID 列 が 160 の データ に アクセス する に は 、 表 の データ 内 の どこ に 160 の もの が 格納 さ れ て いる か わから ない ため 、 すべ の ブロック を 読み取る 必要 が あり ます 。 したがって 、 読み取る データ 量 は 、 200 ブロック と なり ます 。 一方 、 索引 を 使用 する 場合 は 、 索引 の ルート ノード 、 インターナルノード 、 リーフ ノード の 各 1 ブロック を 読み込み ます 。 その後 、 リーフ ノード の ポインタ を 使い 、 表 の データ 中 ID 列 が 160 の 行 データ が 格納 さ れ て いる 1 ブロック だけ を 読み取り ます 。 この ため 索引 を 使用 し た 場合 の 読み取る データ 量 は 4 ブロック だけ で 済み ます 。 ブロック は 、 DBMS における データ の 格納 単位 で 、 B + TREE 索引 の 検索 性能 。 この よう に 、 B + TREE 索引 を 使用 する と 、 対象 の データ を 取得 する の に 必要 な 読み取り 量 を 削減 でき 、 検索 を 高速 に でき ます 。 なお 、 B + TREE 索引 は 、 WHERE ID = 3 の よう な 検索 （ 完全 一致 検索 ） だけ で なく 、 WHERE ID > 100 の よう な 範囲 を 指定 し た 検索 （ 範囲 検索 ） で も 使用 する こと が でき ます 。 ただし 、 データ を 集計 する よう な 処理 で は 、 すべて の 表 の ブロック を 読み込む 必要 が ある ため B + TREE 索引 による 検索 速度 の 向上 は 見込め ませ ん 。 先 の VEGETABLES 表 から ID 160 を 取り出す よう な 特定 の データ 取得 時 の データ 量 と 検索 に 必要 な 平均 時間 （ 読み取り ブロック 平均 数 ） の 関連 を グラフ に 示し ます 。 グラフ 中 、 表 の データ を 直接 読み込む 場合 は 、 データ 量 と 検索 に 必要 な 時間 は 正比例 し ます 。 一方 、 B + TREE 索引 を 使用 し た 場合 は 、 データ 量 に対して 必要 な 時間 は 、 表 の とき と 比べ 緩やか に 増加 し ます 。 また 、 データ 量 が 同じ とき 、 B + TREE 索引 を 作成 する データ が 以下 の 条件 を 満たす ほど 検索 性能 は 向上 し ます 。 データ の 種類 が 多い 。 データ の 種類 が 多い と は 、 列 に 格納 さ れる 値 の 種類 が 多い もの を いい ます 。 例えば 、 社員 番号 は 、 社員 の 数 だけ 一意 な 値 を 持ち ます 。 この よう な もの を 、 データ の 種類 が 多い と いい ます 。 一方 、 性別 は 、 取り うる 値 が 男 、 女 、 その他 の よう に 数種類 しか ない ため データ の 種類 が 少ない と いい ます 。 データ の 偏り が 小さい 。 例えば 値 1 、 2 、 3 が 出現 する 回数 が それぞれ 1 が 50 回 、 2 が 150 回 、 3 が 1000 回 より 1 が 400 回 、 2 が 400 回 、 3 が 400 回 の 方 が データ の 偏り が 小さい と いい ます 。 索引 の 考慮 事項 に は 、 以下 の もの が あり ます 。 データ の 更新 性能 の 低下 ： 索引 を つけ た 列 の データ を 更新 する とき は 、 表 の データ と 一緒 に 索引 も 更新 する 必要 が ある ため 。 索引 用 の 領域 が 追加 で 必要 ： 索引 も 列 の データ と ポインタ を 保存 する ため 。 この ため 索引 は 、 実行 する 検索 に 合わせ て 適切 な もの を 作成 する 必要 が あり ます 。 なお 、 索引 を 作成 する SQL は 、 標準 化 さ れ て い ない ため DBMS に 依存 し ます 。 ビット マップ 索引 。 ビット マップ 索引 は 、 対象 と する 列 の 値 ごと の ビット マップ を 持っ た 索引 です 。 ビット マップ 索引 は 、 以下 の 特徴 が あり ます 。 データ 量 が 多く 、 データ の 種類 が 少ない 表 の 列 に 有効 。 検索 条件 に 複数 の 列 を AND や OR で 組み合わせ た 検索 が 高速 。 ビット マップ 索引 の 構造 を 示し ます 。 CLOTHES 表 の 「 COLOR 」 列 と 「 SIZE 」 列 に ビット マップ 索引 を 作成 し て い ます 。 ビット マップ 索引 は 、 列 の 値 ごと に ビット マップ を 作成 し ます 。 具体 的 に は 、 「 COLOR 」 列 の 「 赤 」 と 「 青 」 と 「 SIZE 」 列 の 値 「 S 」 、 「 L 」 、 「 M 」 の ビット マップ が 作成 さ れ ます 。 また 、 SELECT 文 の よう に 、 検索 条件 の AND は 、 ビット マップ の 値 で AND ビット 演算 を 行い 、 取得 対象 行 を 特定 し ます 。 検索 条件 に COLOR = ‘ 青 ’ AND SIZE = ‘ S ’ と し て いる ので 、 「 青 」 の ビット マップ と 「 S 」 の ビット マップ で AND ビット 演算 を 行い ます 。 その 結果 、 ビット が 1 と なっ て いる （ ビット が 立っ て いる ） 行 が 検索 条件 に 一致 する もの と なり ます 。 ビット マップ 索引 は 、 AND や OR を 使用 し た 検索 を ビット 演算 によって 、 高速 に 行え ます 。 索引 に は 、 索引 作成 列 の 値 を ハッシュ 値 として 保持 し て おく ハッシュ 索引 という もの も あり ます 。 ハッシュ 索引 に は 、 以下 の 特徴 が あり ます 。 一般 的 に B + TREE 索引 と 比べ た 場合 、 性能 が 良い 。 検索 条件 を 特定 の 値 と する 完全 一致 検索 で だけ 使用 でき 、 範囲 を 指定 し た 範囲 検索 で は 使用 でき ない 。 また 、 通常 、 B + TREE 索引 で は 、 索引 を 作成 する 表 の データ の 並び 順 は 索引 に対して ランダム です 。 これ に対して 、 表 データ を 索引 と 同じ 並び 順 に する クラスタ 索引 という もの も 存在 し ます 。 通常 の 索引 （ 非 クラスタ 索引 ） で は 、 範囲 検索 の 結果 など 、 一連 の 表 データ を 読み込む の 際 、 ランダム に ブロック を 取得 する 必要 が あり ます 。 一方 、 クラスタ 索引 で は 、 一連 の 表 データ を 連続 し て （ シーケンシャル に ） 読み取る こと が できる ため 、 検索 性能 を 通常 の 索引 より も 向上 さ せる こと が でき ます 。 索引 は 、 検索 を 高速 に する ため の もの で ある 。 B + TREE 索引 は 、 構造 および 表 データ まで の アクセス 手順 を 理解 する こと が 重要 で ある 。 ビット マップ 索引 は 、 B + TREE 索引 と の 違い を 理解 する こと が 重要 で ある 。 
