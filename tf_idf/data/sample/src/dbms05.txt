 データモデル の 分析 アプローチ 。 テーマ 016 ～ 20 で は 、 概念 データモデル 、 論理 データモデル を 作成 する 際 の 分析 アプローチ や 各種 の 手法 について 学習 し ます 。 データモデル 設計 の 流れ 。 データモデル 設計 は 概念 設計 、 論理 設計 、 物理 設計 の 三 段階 に 分類 する こと が でき ます 。 概念 設計 。 概念 設計 で は 、 対象 と なる システム が 管理 す べき 対象 を 明確 に する 概念 データモデル を 作成 し ます 。 組織 として 用語 集 や 概念 CDM といった 文書 が 存在 する 場合 は 、 整合 性 を 合わせ た 構造 で 設計 し ます 。 適用 する プロジェクト 標準 によって 分析 ・ 設計 状況 が 異なり ます が 、 一般 的 に は 、 具体 的 な データベース 製品 や データ 量 など の 非 機能 要件 が 完全 に 確定 し て い ない 要件 定義 フェーズ で 概念 設計 を 実施 し ます 。 この ため 概念 設計 で は 、 実装 対象 製品 に 依存 する オブジェクト （ 表 や ビュー など ） や 、 検索 や 更新 など の データ 操作 高速 化 を 踏まえ た 設計 を おこない ませ ん 。 概念 データモデル は 、 対象 業務 で 取り扱う データ の 種類 や 項目 など の 漏れ が ない か を 確認 する ため に 作成 さ れ ます 。 共通 の 用語 で 、 関係 代数 を 用いる こと で 導出 可能 な データ 項目 について は 整理 し て 、 正規 化 さ れ た 構造 の データモデル を 作成 し 、 概念 スキーマ を 設計 し ます 。 論理 設計 。 論理 設計 で は 、 データベース の 論理 的 構造 を 明確 に し た 論理 データモデル を 作成 し ます 。 データ 中心 アプローチ による システム 開発 の 場合 は 、 概念 データモデル を そのまま 引き継ぎ 、 洗練 化 する 方向 で 論理 データモデル を 作成 し ます 。 概念 設計 と は 異なり 、 アプリケーション から の アクセス 方法 や ソフトウェア の 内部 構造 と の 整合 性 の とれ た 論理 的 な データモデル と する ため 、 ソフトウェア の 方式 に 依存 し た 用語 も 使用 する こと が あり ます 。 一般 的 に 論理 設計 は 、 ソフトウェア 方式 設計 が 決定 し た 外部 設計 フェーズ で 実施 し ます 。 この ため 外部 システム や 利用 者 など の 接点 を 意識 し た 設計 、 および 性能 要件 など を 含む 非 機能 要件 も 織り込ん だ 外部 スキーマ の 設計 も あわせ て 実施 し ます 。 物理 設計 。 物理 設計 で は 、 論理 データモデル を もと に システム 要件 に 合わせる よう に 物理 データモデル を 設計 し ます 。 物理 設計 の 段階 で は 、 使用 する データベース 製品 や 具体 的 な サーバ 配置 など が 確定 し て いる ので 、 こう いっ た 物理 配置 に データモデル を 合わせる 作業 を おこない ます 。 具体 的 に は 、 データベース 管理 者 から み た オブジェクト の 集まり で ある 内部 スキーマ を 設計 し ます 。 データ モデリング 。 データモデル を 設計 する こと を 、 データ モデリング と よび ます 。 テーマ 005 で 記述 し た よう に 、 概念 データモデル の 作成 に は 、 トップダウン アプローチ と ボトムアップ アプローチ の 二つ の 方法 が あり ます 。 トップダウン アプローチ 。 トップダウン アプローチ で は 、 システム 化 対象 範囲 全体 の おおまか な データ 構造 を 検討 し 、 必要 な データ の まとまり （ エンティティ と なる ） へ と 細分 化 し 、 保持 する データ 項目 へ 更に 詳細 化 し て いき 、 対象 業務 の データモデル を 構築 し て いく 方法 です 。 トップダウン アプローチ の インプット として は 、 ステークホルダ と の ヒアリング 内容 や 、 コンテキスト ダイヤグラム や 業務 フロー など の 要件 定義 フェーズ で の 成果 物 と なり ます 。 例えば 、 学生 の 出席 を 管理 する システム の 場合 、 モノ ・ コト 分析 を 用い て おおまか な データ の まとまり （ エンティティ ） を 検討 し 、 業務 として 取り扱い やすい 単位 へ と 細分 化 し て 初期 の 概念 データモデル を 作成 する 。 その後 、 どう いっ た データ 項目 が 必要 か を 洗い出し データモデル を 更に 詳細 化 し て いき 、 正規 化 を おこない データ 重複 を 排除 し ます 。 ボトムアップ アプローチ 。 ボトムアップ アプローチ で は 、 具体 的 な 画面 や 帳票 など から 個々 の 詳細 な データ 項目 を 洗い出し 、 データ 項目 の まとまり を 検討 し て 段階 的 に 抽象 化 し て いく 方法 です 。 ボトムアップ アプローチ の インプット として は 、 新規 システム や 既存 システム の 画面 イメージ や 帳票 イメージ 、 または 具体 的 に 使用 し て いる 業務 マニュアル など ビジネス 文書 を 用い ます 。 例えば 、 学生 の 出席 を 管理 する システム の 場合 、 出席 簿 や 出席 簿 管理 マニュアル など の ビジネス 文書 から 、 欠席 や 遅刻 の 時 の 必須 項目 や 取り うる 範囲 など を 抽出 し 、 洗い出さ れ た データ 項目 で 正規 化 を 実施 し ながら データ を まとめ 、 最終 的 に 全体 の データ 構造 を 決め て いき 、 概念 データモデル を 作成 し ます 。 データ モデリング 作業 の 流れ 。 通常 の システム 開発 で は 、 要件 定義 初期 に ステークホルダ と の ヒアリング が 集中 する ため 、 最初 は トップダウン アプローチ で 作業 を 進め 、 ある程度 の 全体 構造 が 明確 に なる と 、 ボトムアップ アプローチ を 用い て データ 項目 を 洗い出す という 作業 の 流れ が 一般 的 です 。 データモデル の 検証 。 ロバストネス 分析 、 CRUD 分析 など を 用い て 、 作成 し た データモデル が 要件 や 仕様 に 合致 する か どう か 検証 を おこない ます 。 これら の 分析 手法 以外 に 、 UML の シーケンス 図 や コラボレーション 図 を 用い た コンポーネント 間 の 矛盾 が ない か 確認 する など の 検証 作業 を おこない ます 。 ロバストネス 分析 。 ロバストネス 分析 と は 、 概念 データモデル や 業務 フロー から 分析 レベル の オブジェクト （ エンティティ ） を みつける 分析 手法 の こと です 。 シナリオ 単位 で ロバストネス 分析 を 作成 する こと で 、 プロセス が 必要 と する エンティティ を 洗い出す こと が でき ます 。 もともと は オブジェクト 指向 開発 方法 論 OOSE （ Object Oriented Software Engineering ） で 提案 さ れ た オブジェクト 指向 分析 の ため の アプローチ です が 、 データ 中心 アプローチ で も 活用 可能 です 。 ロバストネス 分析 で は 、 業務 シナリオ ごと に ロバストネス 図 を 書き ながら 進め ます 。 ロバストネス 図 に は 、 図表 2 右 上 の 黒 破線 枠 の よう に 三つ の アイコ ン を 使用 し ます 。 バウンダリ 、 コントロール 、 エンティティ は それぞれ 入力 項目 、 ソフトウェアシステム の 処理 、 管理 する データ を あらわし 、 「 画面 」 から 入力 し た データ を 「 処理 」 し て どういう 「 データ 」 を 追加 、 参照 、 更新 、 削除 する か を シナリオ 単位 で 図 に 作成 し ます 。 すべて の ロバストネス 図 を 作成 し て 、 データモデル の 候補 として 洗い出し を おこない ます 。 CRUD 分析 。 CRUD 分析 と は 、 システム の 機能 と データ 操作 を 対応付け 、 データ の ライフサイクル に 矛盾 が ない か を 確認 する 分析 手法 です 。 CRUD 分析 で は CRUD 図 を 使用 し ます 。 ある 金融 信託 商品 の 商品 設定 から 、 預入 、 償還 まで を 一連 の シナリオ と し た CRUD 図 です 。 行 ごと に プロセス を あらわし 、 上 から 順番 に シナリオ が 流れる こと を 示し て い ます 。 列 は システム が 提供 する データ を あらわし て い ます 。 表 の 値 は 、 対象 の プロセス が 対象 の データ に対して どの よう な 操作 を 実行 し て いる か C （ Create 、 追加 ） 、 R （ Read 、 参照 ） 、 U （ Update 、 更新 ） 、 D （ Delete 、 削除 ） の 記号 で あらわし て い ます 。 CRUD 図 を 参照 し ながら 、 各 プロセス で 実行 する 処理 に 矛盾 が ない か を 確認 し ます 。 プロセス が 上 から 順番 に 並ん で いる ため 、 最初 の 行 で 「 R 」 と なっ て いる データ に対して は 、 その データ の 作成 （ 「 C 」 ） が 事前 に 行わ れ て いる か を 確認 し ます 。 また プロセス の 最後 が 「 D 」 で は ない 場合 は 、 アプリケーション 運用 プロセス など で データ 削除 を おこなっ て いる か どう か を 確認 する など 、 複数 の シナリオ 間 で 矛盾 が 発生 し て い ない か を 確認 し ます 。 トップダウン アプローチ は 、 システム 化 対象 範囲 全体 の おおまか な データ 構造 を 検討 し 、 必要 な データ の まとまり へ と 細分 化 し 、 保持 する データ 項目 へ 更に 詳細 化 し て いき 、 データモデル を 構築 し て いく 方法 で ある 。 ボトムアップ アプローチ は 、 具体 的 な 画面 や 帳票 など から 個々 の 詳細 な データ 項目 を 洗い出し 、 データ 項目 の まとまり を 検討 し て 段階 的 に 抽象 化 し て いく 方法 で ある 。 CRUD 分析 と は 、 システム の 機能 と データ 操作 を 対応付け 、 データ の ライフサイクル に 矛盾 が ない か を 確認 する 分析 手法 で ある 。 データモデル の 表記 法 。 E - R 図 。 E - R 図 （ Entity - Relationship Diagram 、 実体 関連 図 ） と は 、 データ 間 の 関連 を モデル 化 し た 図 、 もしくは その 手法 の 総称 を あらわし ます 。 E - R 図 は 、 エンティティ タイプ 、 リレーションシップ 、 多 重度 、 スーパー タイプ と サブ タイプ 、 属性 など の 要素 で 構成 さ れ て い ます 。 E - R 図 の 表記 法 として は 種々 ある ため 、 データベース スペシャリスト 午後 試験 の 先頭 ページ で は 、 問題 や 回答 記述 の 際 に 使用 する 表記 法 を 掲載 し て い ます 。 本 テキスト で は 、 試験 で 使用 する 記法 に したがっ て E - R 図 を 学習 し ます 。 エンティティ タイプ 。 エンティティ と は 、 組織 において 長期 的 に 管理 対象 と なり うる データ の 実体 の あ つまり を さし ます 。 エンティティ タイプ は 、 エンティティ を 表現 する 型 の こと を さし 、 E - R 図 に 表記 する 要素 を さし ます 。 エンティティ は 抽象 的 な 概念 です が 、 最終 的 な 実装 物 は 表 や ビュー に 相当 し ます ので 、 データベース の 論理 設計 から 物理 設計 にかけて は 基本 的 に 「 エンティティ タイプ ＝ 表 」 と 理解 し て おい て 構い ませ ん 。 E - R 図 において エンティティ タイプ は 、 長方形 で あらわし 、 長方形 の 中 に エンティティ タイプ 名 を 記入 し ます 。 リレーションシップ 。 リレーションシップ は 、 エンティティ タイプ 間 に 存在 する 組織 上 の ルール や ビジネス ルール を あらわし ます 。 例えば 、 注文 表 1 行 に 対応 する 注文 明細 表 の 行 が 存在 する とか 、 対応 する 注文 明細 表 の 行 が 存在 し ない 注文 表 の 行 は 存在 し て は なら ない など を リレーションシップ で 表現 する こと が でき ます 。 リレーションシップ は 、 最終 的 な 実装 物 として 表 間 の 制約 や トリガ に 相当 し ます 。 E - R 図 において リレーションシップ は 、 エンティティ タイプ の 間 に 引か れ た 実線 で あらわし ます 。 データ 操作 を 起点 に あらかじめ 定め られ た 処理 を 実行 する DBMS 機能 の 一つ です が 、 実装 さ れ て い ない 製品 も あり ます 。 多 重度 。 エンティティ 間 の インスタンス （ 実現 値 ） の 種類 数 に関する 対応 関係 を 多 重度 （ カーディナリティ ） と いい ます 。 リレーションシップ で は 矢印 で 多 重度 の 上限 を 指定 する こと が でき ます 。 下限 が 0 件 で ある こと を 許す か どう か について は 、 ” ○ ” や ” ● ” を 用い て 表現 する こと が でき ます 。 一方 の エンティティ タイプ の インスタンス から 見 て 、 他方 の エンティティ に 対応 する インスタンス が 存在 し ない こと が ある 場合 、 リレーションシップ を あらわす 線 の 対応 先 側 （ 他方 側 ） に ” ○ ” を つける 。 一方 の エンティティ タイプ の とある インスタンス から 見 て 、 他方 の エンティティ タイプ に 対応 する 行 が 必ず 存在 する 場合 、 リレーションシップ を あらわす 線 の 対応 先 側 （ 他方 側 ） に ” ● ” を つける 。 上記 の うち エンティティ タイプ を 表 、 インスタンス を 行 と 読み替える と 理解 し やすい と 思い ます 。 スーパー タイプ 、 サブ タイプ 。 オブジェクト 指向 の 継承 に 相当 する エンティティ 間 の 汎 化 、 特 化 の 関連 について も 、 識別子 で 表現 する こと が でき ます 。 汎 化 側 の エンティティ を スーパー タイプ 、 特 化 側 を サブ タイプ と よび ます 。 E - R 図 で は 識別子 ” △ ” を 用いる こと で スーパー タイプ 、 サブ タイプ を 表現 する こと が でき ます 。 属性 。 システム 開発 の 上流 で は 属性 が 決定 し て い ない こと が 多く 、 初期 の 概念 データモデル で は 属性 を 省略 し て 表記 し ます 。 しかし 、 設計 が 進む と エンティティ タイプ に 定義 する 属性 が 決まる ため 、 E - R 図上 に 属性 が 登場 し ます 。 クラス 図 。 UML の クラス 図 の 主要 な 表記 法 について 学習 し ます 。 クラス 。 E - R 図 における エンティティ は 、 クラス 図 における ” クラス ” で 表現 し ます 。 クラス 図 の クラス は 、 長方形 で あらわし 、 長方形 の 中 に クラス 名 を 記入 し ます 。 属性 を 表記 する 場合 は 、 クラス の 長方形 を 上下 二 段 に 分割 し 、 上段 に クラス 名 、 下段 に 属性 名 を 縦 に 表記 し ます 。 関連 。 リレーションシップ は 、 クラス 図 における ” 関連 ” で 表現 し ます 。 クラス 図 の 関連 は 、 クラス の 間 に 引か れ た 実線 で 表現 し ます 。 関連 によって あらわさ れる それぞれ の クラス の 役割 を あらわす ” ロール 名 ” を つける こと が でき ます 。 ロール 名 は 、 関連 の 線 の 中央 に 記述 し ます 。 多 重度 。 E - R 図 で は 矢印 や ” ○ ” 、 ” ● ” を 用い て 多 重度 を 表現 し て い まし た 。 クラス 図 に も ” 多 重度 ” という 要素 が 存在 し て おり 、 これ を 関連 端 に 付加 する こと で 表現 し ます 。 クラス 図 の 多 重度 は 、 上限 数 、 下限 数 を あらわす こと も 可能 です 。 例えば 2 個 以上 5 個 以下 を あらわす 場合 は 「 2 .. 5 」 と 表記 し ます 。 汎 化 。 スーパー タイプ ・ サブ タイプ を クラス 図 で 表現 する 場合 、 クラス 図 の ” 汎 化 ” を 使用 し ます 。 汎 化 は スーパー タイプ 側 に ” △ ” を 付加 し 、 サブ タイプ まで 実線 を 引い て 表現 し ます 。 コメント 。 クラス 図 に は 、 ” コメント ” を 表記 する こと が でき ます 。 コメント は 長方形 の 右 上端 を 折り返し た 形状 と 、 コメント 対象 を 破線 で 結び ます 。 「 教師 」 という ロール 名 から 破線 で 結ば れ て いる 部分 が コメント です 。 E - R 図 （ 実体 関連 図 ） と は 、 データ 間 の 関連 を モデル 化 し た 図 、 もしくは その 手法 の 総称 を あらわす 。 E - R 図 は 、 エンティティ タイプ 、 リレーションシップ 、 多 重度 、 スーパー タイプ と サブ タイプ 、 属性 など の 要素 で 構成 さ れ て いる 。 UML の クラス 図 は 、 クラス 、 関連 、 ロール 名 、 多 重度 、 汎 化 、 コメント など の 要素 で 構成 さ れ て いる 。 多 重度 。 1 対 1 。 1 対 1 と なる ケース 。 以下 の 受注 票 、 出庫 票 の 運用 ルール を もと に 、 概念 データモデル を 作成 せよ 。 受注 票 を もと に 出庫 票 を 作成 する 。 1 枚 の 受注 票 に対して かならず 出庫 票 は 1 枚 発行 さ れる 。 受注 票 と 出庫 票 という データ の 集まり が ある こと から 、 二つ の エンティティ 「 受注 」 、 「 出庫 」 を 作成 し ます 。 そして 「 1 枚 の 受注 票 に対して かならず 出庫 票 は 1 枚 発行 さ れる 」 と ある ため 、 「 1 回 の 受注 に対し 、 かならず 出庫 は 一 度 」 という ビジネス ルール が 存在 し て いる と 判断 し て E - R 図 を 作成 し ます 。 データ モデリング において 、 1 対 1 が 表れる ケース は まれ です 。 1 対 1 は 、 特別 な ビジネス ルール が 存在 する 場合 に 表れ ます 。 既存 の データモデル を 読む 際 に 、 1 対 1 の リレーションシップ が 表れ た 場合 は 、 特殊 な 規則 の 有無 を 確認 し ます 。 1 対 1 の 関係 が 表れる 例 として は 、 予約 ・ 実績 や 見積 ・ 契約 ・ 出荷 といった 業務 プロセス の 状態 （ 同じ データ の 集まり で 値 が 変化 ） など を あらわす 場合 が あげ られ ます 。 1 対 多 。 1 対 多 と なる ケース 。 以下 の ヒアリング 内容 を もと に 概念 データモデル を 作成 せよ 。 ある 会社 に は 、 部署 が 複数 存在 する 。 社員 は 、 かならず 部署 に 所属 する 。 社員 は 、 2 箇所 以上 の 部署 に 所属 する こと は ない 。 上記 の 例 の 中心 は 社員 と 部署 に関する ビジネス ルール で ある ため 、 「 社員 」 と 「 部署 」 という 二つ の エンティティ を 作成 し ます 。 そして 二つ の エンティティ に関する ビジネス ルール に 注目 し ます 。 ここ で は 「 社員 は 、 2 箇所 以上 の 部署 に 所属 する こと は ない 」 と ある ため 、 社員 一 人 に対して 部署 は 一つ 決まり ます 。 また 、 一つ の 部署 に は 社員 が 複数 名 在籍 する 可能 性 が ある ので 、 E - R 図 と なり ます 。 データモデル に 現れる リレーションシップ の 大半 は 、 1 対 多 の 関係 に なり ます 。 午後 試験 で E - R 図 を 完成 さ せる 問題 の 多く は 1 対 多 で あり 、 次に スーパー タイプ 、 サブ タイプ 、 そして 1 対 1 の リレーションシップ の 順 で 登場 し ます 。 代表 的 な 例 として 以下 の ケース が あり ます 。 ① 大 分類 、 中 分類 、 小 分類 。 ② 顧客 と 顧客 を 分類 する 区分 。 ③ 帳票 ・ 画面 の ヘッダ 部分 と 明細 部分 。 上記 の ③ について は 、 次 の セクション の 事例 として 学習 し ます 。 名詞 抽出 法 を 使用 し た 場合 。 業務 要件 記述 の 名詞 に 着目 し 、 分類 する こと で 、 エンティティ や 属性 を 見つける こと を 名詞 抽出 法 と いい ます 。 大 規模 な システム で あり 、 かつ システム 化 対象 業務 について の 知識 が それほど ない 場合 に しばしば 用い られ ます 。 方法 は 簡単 で 、 業務 用件 記述 の 名詞 部分 を 切り出し 、 KJ 法 など で グルーピング を おこない ます 。 ある程度 グループ 分類 が 整理 でき た 段階 で 、 業務 に 知見 の ある 人 を 加え て エンティティ や 属性 、 ビジネス ルール に 分類 し て いき ます 。 1 対 多 と なる ケース で は 、 「 会社 」 、 「 社員 」 、 「 部署 」 、 「 2 箇所 」 を 切り出し ます 。 次に 組織 グループ 「 会社 」 、 「 部署 」 と 人間 グループ 「 社員 」 、 分類 不能 グループ 「 2 箇所 」 に 分け ます 。 「 会社 」 は 有力 な エンティティ 候補 です が 、 業務 の 中 に 「 他社 」 が 現れ ない ため インスタンス は 常に 一つ だけ で ある ため 保留 と し ます 。 分類 不能 グループ の 「 2 箇所 」 は ビジネス ルール の 一部 で ある 可能 性 が 高い ため エンティティ 候補 から 除外 し ます 。 最終 的 に 「 社員 」 と 「 部署 」 の 二つ を エンティティ として 切り出し ます 。 強 実体 と 弱 実体 。 1 対 多 と なる ケース 。 注 文書 を もと に 概念 データモデル を 作成 せよ 。 注文 番号 は 、 注文 ごと に 一意 と なる 番号 。 注文 日 は 、 注文 し た 年月日 。 注文 明細 欄 に は 商品 番号 、 数量 を 記入 する 。 商品 番号 は 、 商品 ごと に 一意 と なる 番号 。 顧客 番号 は 、 顧客 ごと に 一意 と なる 番号 。 帳票 など から 概念 データモデル を 作成 する 場合 、 まず 1 枚 の 注 文書 の 内容 を 1 行 と し た 非 正規 形 の 表 を 作成 し 、 正規 化 を 実施 し ます 。 正規 化 し た 状態 の E - R 図 です 。 「 注文 」 と 「 注文 明細 」 は 1 対 多 の 関係 と なり ます 。 なお 「 商品 」 と 「 顧客 」 の 二つ の エンティティ は 省略 し て い ます 。 注 文書 が 発行 さ れ た 時点 で 、 注文 明細 に 記入 さ れる 商品 番号 や 数量 が 確定 し て い ます 。 この ため この 構造 の まま システム 化 する 場合 、 「 注文 」 表 へ 1 行 新規 追加 し た とき に は 、 「 注文 明細 」 表 に も 1 行 以上 の データ を 追加 し なけれ ば なり ませ ん 。 また 、 注 文書 が 破棄 さ れ た 時点 で 、 注 文書 に 記載 さ れ て いる 注文 明細 も 同時に 破棄 さ れ ます 。 「 注文 」 表 から 1 行 破棄 し た とき に は 、 「 注文 明細 」 表 上 の 対応 する 行 （ 破棄 対象 の 「 注文 番号 」 が 同じ 行 すべて ） も 削除 し なけれ ば なり ませ ん 。 「 注文 」 表 の よう に 、 他 の 表 の 行 データ が どの よう な 値 で あっ て も 自身 の 行 データ が 存在 可能 な 表 （ エンティティ ） を 強 実体 （ strong entity ） 、 もしくは 正 実体 （ regular entity 、 通常 実体 ） と いい ます 。 また 「 注文 明細 」 表 の よう に 、 他 の 表 の 行 データ が ない と 自身 の 行 データ が 存在 でき ない よう な 表 （ エンティティ ） を 弱 実体 （ weak entity ） と いい ます 。 注 文書 の 中 に は 注文 明細 という " 表 " が 入っ て い ます 。 この よう に 、 帳票 や 画面 の 上 に " 表 " が 存在 する よう な 場合 、 切り ださ れ た エンティティ が 、 強 実体 、 弱 実体 と なる 可能 性 が 高く なり ます 。 多 対 多 。 多 対 多 と なる ケース 。 以下 の ヒアリング 内容 を もと に 概念 データモデル を 作成 せよ 。 ある 会社 に は 、 部署 が 複数 存在 する 。 社員 は 、 かならず 部署 に 所属 する 。 社員 は 基本 的 に 1 部 署 に 所属 する が 、 場合 により 複数 の 部署 を 兼務 する こと が ある 。 1 対 多 と なる ケース と 異なる の は 「 場合 により 複数 の 部署 を 兼務 する こと が ある 」 という ビジネス ルール の 部分 です 。 一般 的 な 会社 で も 、 社員 が 所属 する 部署 が 複数 ある こと が あり ます が 、 この 例 で は 「 兼務 」 と 呼ん で い ます 。 ある 社員 が 複数 の 部署 に 所属 する 可能 性 が ある ため 、 E - R 図 は 多 対 多 の 構造 が 現れ ます 。 多 対 多 の 構造 は 、 トップダウン アプローチ による 概念 データ モデリング の 初期 に は 、 抽象 度 の 高い エンティティ が 中心 と なる ため よく 現れ ます 。 しかし 最終 的 な 物理 データモデル 上 に は 多 対 多 構造 は 登場 し ませ ん 。 関係 データベース 上 に 多 対 多 を 実現 する こと が でき ない ため 、 データ モデリング 中 に 多 対 多 構造 を 排除 する （ 1 対 多 の 関係 を 導き 置き換える ） ため です 。 特別 な ビジネス ルール が 存在 する 場合 に 多 重度 として 1 対 1 が 現れる こと が ある 。 エンティティ 間 の リレーションシップ の 多 重度 は 、 1 対 多 と なる こと が 多い 。 関係 データベース 上 に 多 対 多 を 実現 する こと が でき ない ため 、 データ モデリング 中 に 多 対 多 構造 を 排除 する 。 連関 エンティティ と スーパー タイプ 、 サブ タイプ 。 連関 エンティティ データモデル 作成 中 に 多 対 多 の 構造 が あらわれ た 場合 、 連関 エンティティ を 作成 し て 1 対 多 対 1 の 構造 に 変換 し ます 。 社員 が 複数 の 部署 に 所属 する こと が ある という ビジネス ルール を もと に 作成 し た E - R 図 です 。 この 場合 は 、 1 対 多 と なる よう に 、 「 社員 」 と 「 部署 」 の 間 に 連関 エンティティ を 一つ 配置 し ます 。 エンティティ 候補 として 、 業務 要件 記述 の 中 から 社員 と 部署 と の 間 の 関係 を あらわす 事象 を 調べ ます 。 この 例 で は 「 所属 する 」 もしくは 「 兼務 する 」 が 候補 として 出 て き ます 。 この うち 「 兼務 する 」 は 2 部署 目 以降 に 「 所属 する 」 こと の 言い換え です ので 、 「 所属 」 という 事象 を エンティティ として 選ん で い ます 。 結果 として 多 対 多 が 1 対 多 対 1 の リレーションシップ と なっ て い ます 。 なお 、 連関 エンティティ の 主 キー を 、 連関 を 構成 する 各 エンティティ の 主 キー を 合わせ た 複合 キー として 考える と わかり やすく なり ます 。 多 対 多 構造 で は 、 社員 が 現在 所属 し て いる 部署 の リレーションシップ のみ 表現 し て い まし た 。 ここ で 連関 エンティティ 「 所属 」 を 作成 し 、 属性 として 所属 開始 日 、 所属 終了 日 を 配置 する こと で 、 過去 に 所属 し て い た 部署 の データ も 管理 する こと が でき ます 。 この よう に 連関 エンティティ を 作成 する こと で 、 様々 な ビジネス ルール を 取り込む こと も 可能 と なり ます 。 三つ 以上 の エンティティ の 間 に も 連関 エンティティ を 配置 する こと が でき ます 。 例えば 「 学生 は 、 学期 が 異なれ ば 同じ 授業 科目 を 何 度 でも 履修 できる 」 場合 、 「 履修 」 を 連関 エンティティ として 配置 し ます 。 UML クラス 図 における 連関 エンティティ の 表現 。 UML で 連関 エンティティ （ 関連 クラス と いい ます ） を 表記 する に は 、 二つ の 表記 法 が あり ます 。 ともに E - R 図 を クラス 図 で 表記 し た もの です 。 モノ ・ コト 分析 。 モノ ・ コト 分析 と は 、 オブジェクト 指向 設計 に 使用 さ れる 分析 手法 です 。 ヒアリング 等 により 得 た 業務 要件 記述 から 、 モノ と コト に 着目 し て クラス （ エンティティ ） 、 関連 （ リレーションシップ ） 、 属性 の 候補 を 見つけ ます 。 モノ は 、 人 や 物 など 実体 の ある もの を さし ます 。 コト は 、 事象 を あらわし ます 。 業務 要件 記述 といった 文書 を モノ と コト に 着目 し て 、 エンティティ 、 リレーションシップ 、 属性 など の 候補 として 検討 し ます 。 名詞 抽出 法 と 違う 部分 は コト を 扱う ところ です 。 この モノ ・ コト 分析 は 、 以下 の よう に 連関 エンティティ を 発見 する 際 に 効果 が あり ます 。 顧客 が 社員 と 契約 する → （ 顧客 − 契約 − 社員 ） 、 社員 が 商品 を 出荷 する → （ 社員 − 出荷 − 商品 ） 、 学生 が 授業 を 履修 する → （ 学生 − 履修 − 授業 ） 。 文章 中 の モノ を 太字 に 、 コト に 下線 を 引き 、 「 （ モノ − コト − モノ ） 」 に 変換 し ます 。 そして コト を 連関 エンティティ として モデル を 作成 し ます 。 スーパー タイプ と サブ タイプ 。 スーパー タイプ 、 サブ タイプ は 、 汎 化 ・ 特 化 の リレーションシップ を 表現 する こと が でき ます 。 スーパー タイプ で ある ほど 抽象 的 な エンティティ と なり 、 サブ タイプ に なる ほど 具体 的 な エンティティ と なり ます 。 この ため サブ タイプ は スーパー タイプ の 一つ （ 一種 ） で ある という ビジネス ルール を 表現 する こと が 多い ため 、 is - a 関連 （ is - a - relationship ） と 呼ぶ こと も あり ます 。 スーパー タイプ 、 サブ タイプ の 多く は 、 顧客 や 商品 、 部品 など の マスタ 系 データ の 種類 分け に 使用 し ます 。 ① 口座 に は 、 個人 顧客 が 開設 し た 個人 口座 と 、 法人 顧客 が 開設 し た 法人 口座 が ある 。 ② 個人 顧客 は 、 総合 口座 と 総合 口座 以外 の 口座 （ 以下 、 非 総合 口座 という ） の 両方 を 持つ こと が できる 。 ③ 総合 口座 は 、 代表 と なる 一つ の 普通 預金 口座 （ 以下 、 総合 口座 代表 普通 預金 口座 という ） と 、 同 一 支店 の 定期 預金 など 一つ 以上 の 普通 預金 以外 の 口座 （ 以下 、 総合 口座 組入れ 口座 という ） から なる 。 この 記述 は 、 口座 に関する 業務 要件 記述 を 切り出し た もの で 、 口座 名 の 部分 を 太字 で あらわし て い ます 。 ① は 、 口座 に は 個人 口座 、 法人 口座 の 二つ の 種類 が ある こと を 示し て い ます 。 ② で は 、 個人 顧客 と あり ます が 、 ① で 「 個人 顧客 が 開設 し た 個人 口座 」 と ある ので 、 個人 口座 と 読み替え ます 。 個人 口座 に は 総合 口座 、 非 総合 口座 の 二つ の 種類 が ある こと が わかり ます 。 そして ③ で は 、 総合 口座 は 総合 口座 代表 普通 預金 口座 と 総合 口座 組入れ 口座 の 二つ の 種類 が ある こと が わかり ます 。 また ③ で は 、 総合 口座 が 一つ の 総合 口座 代表 普通 預金 口座 と 一つ 以上 の 総合 口座 組入れ 口座 から なる 、 と 1 対 多 の 関係 も 記述 から 読み取る こと が でき ます 。 スーパー タイプ 、 サブ タイプ の 関係 スキーマ 。 スーパー タイプ 、 サブ タイプ の リレーションシップ を 関係 スキーマ として 表現 する 場合 、 サブ タイプ を 分類 する 「 区分 」 という 属性 を スーパー タイプ 側 に 新た に 作成 する こと が 一般 的 です 。 以下 の 関係 スキーマ は 、 個人 口座 と 法人 口座 の 部分 のみ を 口座 区分 で 分け た 場合 の 例 です 。 口座 （ 口座 番号 , … , 口座 区分 ） 、 個人 口座 （ 口座 番号 , … ） 、 法人 口座 （ 口座 番号 , … ） 。 ここ で は 、 口座 番号 は すべて の 口座 に対して 一意 に 割り当て られ た 番号 と し 、 口座 区分 は 、 属性 値 により 個人 口座 か 法人 口座 か を 振り分ける こと と し ます 。 関係 「 口座 」 の 口座 番号 以外 の 属性 に は 、 個人 口座 、 法人 口座 両方 に ある 共通 の 属性 を 配置 し ます 。 また 個人 口座 、 法人 口座 の 口座 番号 以外 の 属性 に は 、 それぞれ の 口座 固有 の 属性 を 配置 し ます 。 もし サブ タイプ 側 に 固有 の 属性 が ない 場合 は 、 論理 設計 の 段階 で スーパー タイプ に 「 区分 」 を 作成 する だけ に し て サブ タイプ を 削除 する か どう か を 検討 し ます 。 排他 的 と 共存 的 。 個人 口座 と 法人 口座 の よう に 、 それぞれ が 重複 する こと が ない サブ タイプ を 排他 的 で ある と いい ます 。 また 、 取引 先 に対して 仕 入 先 という 分類 と は 別に 、 重点 得意 先 という 分類 を 設け 、 仕 入 先 で も あり 重点 得意 先 で も ある 得意 先 が 存在 する と し ます 。 この とき の 仕 入 先 と 重点 得意 先 の よう に 、 重複 する 可能 性 が ある サブ タイプ を 共存 的 で ある と いい ます 。 排他 的 分類 と 共存 的 分類 を それぞれ E - R 図 で 表現 し た もの です 。 排他 的 な 場合 は リレーションシップ を 分岐 さ せ て 表現 し ます が 、 共存 的 分類 の 場合 は 複数 の リレーションシップ で 表現 し ます 。 完全 と 不完全 。 個人 口座 、 法人 口座 に対して 、 どちら で も ない 口座 が 存在 し ない と し ます 。 この よう な 、 定義 さ れ た すべて の サブ タイプ 以外 の もの が ない こと を 完全 で ある と いい ます 。 また 、 定義 さ れ た すべて の サブ タイプ 以外 の もの が 存在 する 場合 は 不完全 で ある と いい ます 。 なお 、 共存 的 サブ タイプ に対して も 完全 ・ 不完全 な 状態 は あり ます 。 多 対 多 の 構造 は 、 多 対 多 の リレーションシップ の 中間 に 連関 エンティティ を 作成 し て 、 1 対 多 対 1 の 構造 に 変換 する 。 スーパー タイプ 、 サブ タイプ の 多く は 、 マスタ 系 データ の 分類 に 使用 する 。 関係 スキーマ 化 する 際 に は 区分 を 新設 する 方法 が 一般 的 で ある 。 重複 の ない サブ タイプ を 排他 的 、 重複 の ある サブ タイプ を 共存 的 で ある と いう 。 すべて の サブ タイプ 以外 の もの が ない 場合 を 完全 、 ある 場合 を 不完全 で ある と いう 。 データ モデリング 。 部署 。 一般 的 な データ モデリング の 流れ は 、 部署 や 顧客 、 商品 といった モノ を あらわす 部分 から 作成 し 、 次に 製造 や 調達 、 注文 といった コト を あらわす エンティティ を 作成 し 、 その後 リレーションシップ を 張り ます 。 ① A 社 は 、 複数 の 部署 により 組織 運用 を 行っ て いる 。 一般 的 に 企業 は 部署 で 構成 さ れ ます が 、 データモデル 上 で は これ を いくつ か の パターン で 表現 でき ます 。 部署 構造 は 多く の システム の データモデル 上 に 頻出 し 、 E - R 図上 で の 表現 方法 も 大体 決まっ て い ます 。 親子 部署 の リレーションシップ 。 部署 に は ○ ○ 事業 部 や ○ ○ 部 、 ○ ○ 課 など が あり ます 。 多く の 組織 で は 部署 の 下 に 部署 が ある 親子 関係 と なっ て い ます 。 この ため 、 部署 の 親子 関係 を 表現 する リレーションシップ を 自分 自身 に 張っ た 構造 が よく あらわれ ます 。 厳密 に は 最 上位 の 部署 に は 親 部署 が ない ため リレーションシップ の 矢印 の 根元 に 「 ○ 」 を つけ ます 。 サブ タイプ 。 事業 部 、 本部 、 部 、 課 、 係 の 順 に 親子 関係 と なっ て いる 場合 は スーパー タイプ 、 サブ タイプ を 用い て 表記 し ます 。 部署 名 の 中 に 隠れ て い た 部署 構造 を モデル の エンティティ として 登場 さ せる こと で 、 より 具体 的 な データモデル に なり ます 。 ただし 、 ○ ○ 係 の 子 部署 に 同 レベル の 別 の × × 係 や 、 上位 レベル の ○ ○ 本部 など も 許可 し て しまう データモデル と なり ます 。 この よう な 場合 、 アプリケーション 上 で 「 同一 レベル の 部署 が 親 部署 と なる こと は ない 」 や 「 部署 は かならず 事業 部 、 本部 、 部 、 課 、 係 の 順 に なる 」 という ビジネス ルール を 実装 する 必要 が あり ます 。 顧客 。 ② A 社 で は 、 個人 顧客 だけ で なく 法人 顧客 に対して も 取引 を 扱っ て いる 。 最も 簡単 な データモデル として は 、 顧客 エンティティ を 一つ 配置 し て 、 その 属性 として 法人 区分 など の 「 区分 」 を 設ける 方法 です 。 個人 顧客 と 法人 顧客 に関する データ が ほぼ 同じ 場合 は 有効 です が 、 一般 的 に は 個人 顧客 と 法人 顧客 で は 企業 が 保有 する 顧客 データ が 異なり ます 。 この よう な 場合 に 対応 可能 な データモデル を 作成 する に は 、 顧客 の サブ タイプ として 個人 顧客 、 法人 顧客 を 定義 し ます 。 この よう に 個人 顧客 、 法人 顧客 を 異なる エンティティ として 作成 すれ ば 、 個人 顧客 や 法人 顧客 固有 の データ は それぞれ の サブ タイプ の 周囲 に 配置 する こと により 将来 的 に 管理 する 顧客 データ が 増え た 場合 の 拡張 に も 対応 でき ます 。 また 、 法人 顧客 で ある 組織 に 個人 顧客 が 勤務 し て いる 場合 は 、 サブ タイプ 間 に 連関 エンティティ 「 勤務 」 を 配置 し ます 。 パーティ 。 「 顧客 」 は 、 個人 顧客 という 人間 と 、 法人 顧客 という グループ も あらわす 抽象 的 な エンティティ です 。 この よう な 、 人 や グループ （ 組織 ） の 両方 を 完全 に 包含 する エンティティ を パーティ （ Party ） と 呼ぶ こと が あり ます 。 商品 。 ③ A 社 の 商品 は 、 自社 で 製造 する 商品 （ 製造 商品 ） 、 他社 から 調達 する 商品 （ 調達 商品 ） に 分類 さ れる 。 また 、 個人 顧客 へ 販売 する 個人 販売 商品 と 、 法人 顧客 へ 販売 する 法人 販売 商品 という 別 の 分類 も ある 。 データモデル 上 に 種類 や 分類 といった エンティティ を 表現 する 場合 、 通常 スーパー タイプ 、 サブ タイプ を 使用 し ます 。 ここ で は 、 まず 製造 商品 と 調達 商品 という 分類 と 、 個人 販売 商品 と 法人 販売 商品 という 分類 が それぞれ 個別 に 存在 し ます 。 ③ の 業務 要件 記述 で は それぞれ の 分類 が 、 完全 か 不完全 か 、 排他 的 か 共存 的 か が 明確 に なっ て い ませ ん 。 ただし 、 製造 商品 で あり 調達 商品 で ある もの が 存在 し ない こと は 読み取れ ます 。 この ため 、 一方 の 分類 は 排他 的 で あり 不完全 、 他方 の 分類 は 共存 的 で あり 不完全 と し ます 。 分類 を モデル 上 に 表現 する 際 に は 、 その 分類 が 排他 的 か 共存 的 か 、 完全 か 不完全 か を 把握 し なく て も モデル を 作成 する こと が でき ます 。 しかし 、 ほか の エンティティ と の リレーションシップ を 張る 際 に 、 商品 の どの エンティティ と 結べ ば よい の か 判断 する こと が でき ませ ん 。 スーパー タイプ 、 サブ タイプ を 使用 する 場合 、 ベン図 を 用い て 把握 し ます 。 製造 と 調達 、 注文 と 注文 明細 。 ④ 製造 、 調達 を 主管 する 部署 が かならず 1 部 署 存在 する 。 ⑤ 顧客 から 注文 が ある と 注文 票 を 作成 し 、 どの 商品 を 購入 し た か 注文 明細 を 記載 する 。 モノ を あらわす エンティティ の 作成 が 終わっ た 段階 で 、 システム 化 対象 プロセス （ コト ） を モデル 上 に 作成 し て リレーションシップ を 張り ます 。 ④ の 製造 や 調達 は コト を あらわし て いる ので 、 連関 エンティティ として モデル 上 で 表現 し ます 。 。 データ モデリング で は 過去 の 経験 、 習得 し た 知識 や パターン を 活用 する こと で 、 より 早く 正確 な モデル を 作成 する こと が でき ます 。 一般 的 な データモデル 作成 の 流れ は 、 まず モノ を あらわす エンティティ を 作成 し 、 次に コト を あらわす エンティティ と の リレーションシップ を 張る 。 分類 を データモデル で 表記 する 場合 、 リレーションシップ の 張る 対象 を 確定 する ため に 、 完全 か 不完全 か 、 排他 的 か 共存 的 か を 把握 し て おく 必要 が ある 。 過去 の 経験 、 習得 し た 知識 や パターン を 活用 する こと で 、 より 早く 正確 な モデル を 作成 する こと が できる 。 
